<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Existing examples &mdash; opendihu 1.4 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=0ed52906"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Validation" href="validation.html" />
    <link rel="prev" title="Examples" href="examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            opendihu
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Existing examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#laplace-and-poisson">Laplace and Poisson</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#laplace1d">laplace1d</a></li>
<li class="toctree-l3"><a class="reference internal" href="#laplace2d">laplace2d</a></li>
<li class="toctree-l3"><a class="reference internal" href="#laplace3d">laplace3d</a></li>
<li class="toctree-l3"><a class="reference internal" href="#laplace3d-surface">laplace3d_surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#laplace-composite">laplace_composite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#poisson1d">poisson1d</a></li>
<li class="toctree-l3"><a class="reference internal" href="#poisson2d">poisson2d</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#diffusion">Diffusion</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#diffusion1d">diffusion1d</a></li>
<li class="toctree-l3"><a class="reference internal" href="#diffusion2d">diffusion2d</a></li>
<li class="toctree-l3"><a class="reference internal" href="#diffusion3d">diffusion3d</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anisotropic-diffusion">anisotropic_diffusion</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reaction-diffusion2d">reaction_diffusion2d</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pint-diffusion1d">PinT_diffusion1d</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fiber-tracing">Fiber Tracing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parallel-fiber-estimation">parallel_fiber_estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#streamline-tracer">streamline_tracer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#solid-mechanics">Solid Mechanics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#linear-elasticity">Linear Elasticity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mooney-rivlin-isotropic">Mooney-Rivlin isotropic</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mooney-rivlin-transiso">Mooney-Rivlin transiso</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dynamic-mooney-rivlin">Dynamic Mooney-Rivlin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-material">Custom Material</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mooney-rivlin-with-febio">Mooney-Rivlin with FEBio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tensile-test">Tensile Test</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shear-test">Shear Test</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chaste">Chaste</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#electrophysiology">Electrophysiology</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#subcellular-models">Subcellular models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cellml">CellML</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#shorten">Shorten</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hodgkin-huxley-shorten-ocallaghan-davidson-soboleva-2007">hodgkin-huxley_shorten_ocallaghan_davidson_soboleva_2007</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#monodomain">Monodomain</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#hodgkin-huxley">hodgkin_huxley</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hodgkin-huxley-fast">hodgkin_huxley_fast</a></li>
<li class="toctree-l4"><a class="reference internal" href="#motoneuron-hodgkin-huxley">motoneuron_hodgkin_huxley</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-subcellular-models">Other subcellular models</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#fibers">Fibers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#multiple-fibers">multiple_fibers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multiple-fibers-cubes-partitioning">multiple_fibers_cubes_partitioning</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fibers-emg">fibers_emg</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cuboid">cuboid</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fibers-fat-emg">fibers_fat_emg</a></li>
<li class="toctree-l4"><a class="reference internal" href="#analytical-fibers-emg">analytical_fibers_emg</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load-balancing">load_balancing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fibers-contraction-no-precice">fibers_contraction/no_precice</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fibers-contraction-with-tendons-precice">fibers_contraction/with_tendons_precice</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multidomain">Multidomain</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#static-bidomain">static_bidomain</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multidomain-no-fat">multidomain_no_fat</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multidomain-with-fat">multidomain_with_fat</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multidomain-contraction">multidomain_contraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multidomain-motoneuron">multidomain_motoneuron</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#neuromuscular">Neuromuscular</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#only-neurons-hodgkin-huxley">only_neurons_hodgkin_huxley</a></li>
<li class="toctree-l4"><a class="reference internal" href="#only-neurons-mileusenic">only_neurons_mileusenic</a></li>
<li class="toctree-l4"><a class="reference internal" href="#only-neurons-hierarchical-structure">only_neurons_hierarchical_structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#neurons-with-contraction">neurons_with_contraction</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="validation.html">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../settings.html">Python Settings</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer_information.html">Information for developers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">opendihu</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Existing examples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user/existing_examples.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="existing-examples">
<span id="id1"></span><h1>Existing examples<a class="headerlink" href="#existing-examples" title="Link to this heading"></a></h1>
<p>In the following all (or at least the most important) examples are listed. The order corresponds to the directory structure under <cite>opendihu/examples</cite>.
The most examples can be run with any number of processes.</p>
<section id="laplace-and-poisson">
<h2>Laplace and Poisson<a class="headerlink" href="#laplace-and-poisson" title="Link to this heading"></a></h2>
<p>This solves the Laplace equation</p>
<div class="math notranslate nohighlight">
\[Δu = 0\]</div>
<p>with Dirichlet or Neumann-type boundary conditions. This models, e.g. diffusion or heat/electric conduction.</p>
<section id="laplace1d">
<h3>laplace1d<a class="headerlink" href="#laplace1d" title="Link to this heading"></a></h3>
<p>This solves the laplace equation on a line, with linear and quadratic Lagrange ansatz functions or cubic Hermite ansatz functions. Neumann and Dirichlet-type boundary conditions are used.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/laplace/laplace1d
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>Possible scenarios:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./laplace_linear<span class="w"> </span>../settings_linear_quadratic_dirichlet.py<span class="w">      </span><span class="c1"># (1)</span>
./laplace_quadratic<span class="w"> </span>../settings_linear_quadratic_dirichlet.py<span class="w">   </span><span class="c1"># (2)</span>
./laplace_quadratic<span class="w"> </span>../settings_quadratic_neumann.py<span class="w">            </span><span class="c1"># (3)</span>
./laplace_hermite<span class="w"> </span>../settings_hermite_neumann.py<span class="w">                </span><span class="c1"># (4)</span>
./laplace_hermite<span class="w"> </span>../settings_hermite_dirichlet.py<span class="w">              </span><span class="c1"># (5)</span>
</pre></div>
</div>
<p>Output files will be written in the <cite>out</cite> subdirectory. The <cite>*.py</cite> files can be visualized by running <code class="docutils literal notranslate"><span class="pre">plot</span></code>. The <cite>*.vtr</cite> file can be viewed with paraview. System matrices, solution and rhs vectors are dumped in matlab format.</p>
<figure class="align-default" id="id6">
<span id="laplace1d-1"></span><a class="reference internal image-reference" href="../_images/laplace1d_1.png"><img alt="../_images/laplace1d_1.png" src="../_images/laplace1d_1.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">Scenario (1).</span><a class="headerlink" href="#id6" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id7">
<span id="laplace1d-2"></span><a class="reference internal image-reference" href="../_images/laplace1d_2.png"><img alt="../_images/laplace1d_2.png" src="../_images/laplace1d_2.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2 </span><span class="caption-text">Scenario (2).</span><a class="headerlink" href="#id7" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id8">
<span id="laplace1d-3"></span><a class="reference internal image-reference" href="../_images/laplace1d_3.png"><img alt="../_images/laplace1d_3.png" src="../_images/laplace1d_3.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 3 </span><span class="caption-text">Scenario (3).</span><a class="headerlink" href="#id8" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id9">
<span id="laplace1d-4"></span><a class="reference internal image-reference" href="../_images/laplace1d_4.png"><img alt="../_images/laplace1d_4.png" src="../_images/laplace1d_4.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4 </span><span class="caption-text">Scenario (4).</span><a class="headerlink" href="#id9" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id10">
<span id="laplace1d-5"></span><a class="reference internal image-reference" href="../_images/laplace1d_5.png"><img alt="../_images/laplace1d_5.png" src="../_images/laplace1d_5.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Scenario (5). This is overconstrained, it leads to these oscillations.</span><a class="headerlink" href="#id10" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="laplace2d">
<h3>laplace2d<a class="headerlink" href="#laplace2d" title="Link to this heading"></a></h3>
<p>This solves the 2d laplace equation, with linear and quadratic Lagrange ansatz functions or cubic Hermite ansatz functions. <code class="docutils literal notranslate"><span class="pre">laplace_hermite</span></code> demonstrates how to use unstructured grids.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/laplace/laplace2d
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>Some possible scenarios, also others are possible:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./laplace_regular<span class="w"> </span>../settings_lagrange_quadratic.py<span class="w">      </span><span class="c1"># (1)</span>
./laplace_structured<span class="w"> </span>../settings_quadratic_neumann.py<span class="w">    </span><span class="c1"># (2)</span>
./laplace_hermite<span class="w"> </span>../settings_hermite.py<span class="w">                 </span><span class="c1"># (3)</span>
./laplace_hermite<span class="w"> </span>../settings_hermite_neumann.py<span class="w">         </span><span class="c1"># (4)</span>
</pre></div>
</div>
<figure class="align-default" id="id11">
<span id="laplace2d-1"></span><a class="reference internal image-reference" href="../_images/laplace2d_1.png"><img alt="../_images/laplace2d_1.png" src="../_images/laplace2d_1.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">Scenario (1).</span><a class="headerlink" href="#id11" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id12">
<span id="laplace2d-2"></span><a class="reference internal image-reference" href="../_images/laplace2d_2.png"><img alt="../_images/laplace2d_2.png" src="../_images/laplace2d_2.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 7 </span><span class="caption-text">Scenario (2).</span><a class="headerlink" href="#id12" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id13">
<span id="laplace2d-3"></span><a class="reference internal image-reference" href="../_images/laplace2d_3.png"><img alt="../_images/laplace2d_3.png" src="../_images/laplace2d_3.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 8 </span><span class="caption-text">Scenario (3).</span><a class="headerlink" href="#id13" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id14">
<span id="laplace2d-4"></span><a class="reference internal image-reference" href="../_images/laplace2d_4.png"><img alt="../_images/laplace2d_4.png" src="../_images/laplace2d_4.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 9 </span><span class="caption-text">Scenario (4). This was visualized using ParaView. The Neumann BC are shown by the arrows.</span><a class="headerlink" href="#id14" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="laplace3d">
<h3>laplace3d<a class="headerlink" href="#laplace3d" title="Link to this heading"></a></h3>
<p>This solves the 3d laplace equation.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/laplace/laplace3d
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>Possible scenarios, more are possible and need adjustments in the settings files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span><span class="w"> </span>./laplace_regular_fixed<span class="w"> </span>../settings_neumann.py<span class="w">      </span><span class="c1"># (1)</span>
./laplace_structured_deformable<span class="w"> </span>../settings_fat_tissue.py<span class="w">       </span><span class="c1"># (2)</span>
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">3</span><span class="w"> </span>--oversubscribe<span class="w"> </span>./petsc_test<span class="w"> </span>../settings_dirichlet.py<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;failed&quot;</span>
</pre></div>
</div>
<p>Note that the <cite>plot</cite> script only works for 1D and 2D data. For 3D data, Paraview is recommended.</p>
<figure class="align-default" id="id15">
<span id="laplace3d-1"></span><a class="reference internal image-reference" href="../_images/laplace3d_1.png"><img alt="../_images/laplace3d_1.png" src="../_images/laplace3d_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 10 </span><span class="caption-text">Scenario (1). A simulation run with 8 processes, left: solution, right: partitioning.</span><a class="headerlink" href="#id15" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id16">
<span id="laplace3d-2"></span><a class="reference internal image-reference" href="../_images/laplace3d_2.png"><img alt="../_images/laplace3d_2.png" src="../_images/laplace3d_2.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 11 </span><span class="caption-text">Scenario (2). This simply shows the geometry.</span><a class="headerlink" href="#id16" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="laplace3d-surface">
<h3>laplace3d_surface<a class="headerlink" href="#laplace3d-surface" title="Link to this heading"></a></h3>
<p>Solve the 3D Laplace problem and demonstrate how to use :doc:/settings/output_surface to extract a surface. This is needed if the full 3D data would be too large to output, but a 2D surface is okay.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/laplace/laplace3d_surface
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>Possible scenarios, more are possible and need adjustments in the settings files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./laplace_surface<span class="w"> </span>../settings_surface.py<span class="w">                   </span><span class="c1"># (1)</span>
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./laplace_surface<span class="w"> </span>../settings_surface.py<span class="w">       </span><span class="c1"># (2)</span>
</pre></div>
</div>
<figure class="align-default" id="id17">
<span id="laplace3d-surface-1"></span><a class="reference internal image-reference" href="../_images/laplace3d_surface_1.png"><img alt="../_images/laplace3d_surface_1.png" src="../_images/laplace3d_surface_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 12 </span><span class="caption-text">Scenario (1). Left: the full mesh, right: only surface as written by the OutputSurface writer.</span><a class="headerlink" href="#id17" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id18">
<span id="laplace3d-surface-2"></span><a class="reference internal image-reference" href="../_images/laplace3d_surface_2.png"><img alt="../_images/laplace3d_surface_2.png" src="../_images/laplace3d_surface_2.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 13 </span><span class="caption-text">Scenario (2). This shows that it also works with parallel execution (4 processes). Note how the surface is only written by two processes, whereas the volume is written by all 4 processes.</span><a class="headerlink" href="#id18" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="laplace-composite">
<h3>laplace_composite<a class="headerlink" href="#laplace-composite" title="Link to this heading"></a></h3>
<p>Demonstrate how to use a composite mesh.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/laplace/laplace_composite
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>Possible scenarios:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./laplace_composite_2d<span class="w"> </span>../settings_2d.py<span class="w">                   </span><span class="c1"># (1)</span>
./laplace_composite_3d<span class="w"> </span>../settings_3d.py<span class="w">                   </span><span class="c1"># (2)</span>
./laplace_composite_linear_3d<span class="w"> </span>../settings_linear_3d.py<span class="w">     </span><span class="c1"># (3)</span>
./laplace_composite_linear_2d<span class="w"> </span>../settings_linear_2d.py<span class="w">     </span><span class="c1"># (4)</span>
</pre></div>
</div>
<figure class="align-default" id="id19">
<span id="laplace-composite-1"></span><a class="reference internal image-reference" href="../_images/laplace_composite_1.png"><img alt="../_images/laplace_composite_1.png" src="../_images/laplace_composite_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 14 </span><span class="caption-text">Scenario (1).</span><a class="headerlink" href="#id19" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id20">
<span id="laplace-composite-2"></span><a class="reference internal image-reference" href="../_images/laplace_composite_2.png"><img alt="../_images/laplace_composite_2.png" src="../_images/laplace_composite_2.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 15 </span><span class="caption-text">Scenario (2). Two different views.</span><a class="headerlink" href="#id20" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id21">
<span id="laplace-composite-3"></span><a class="reference internal image-reference" href="../_images/laplace_composite_3.png"><img alt="../_images/laplace_composite_3.png" src="../_images/laplace_composite_3.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 16 </span><span class="caption-text">Scenario (3).</span><a class="headerlink" href="#id21" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id22">
<span id="laplace-composite-4"></span><a class="reference internal image-reference" href="../_images/laplace_composite_4.png"><img alt="../_images/laplace_composite_4.png" src="../_images/laplace_composite_4.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text">Scenario (4).</span><a class="headerlink" href="#id22" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="poisson1d">
<h3>poisson1d<a class="headerlink" href="#poisson1d" title="Link to this heading"></a></h3>
<p>This solves the poisson equation <span class="math notranslate nohighlight">\(\partial^2 u/\partial x^2 = f\)</span> on a line.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/poisson/poisson1d
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>Possible scenarios:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./poisson_example<span class="w"> </span>../settings_1d.py<span class="w">      </span><span class="c1"># (1)</span>
</pre></div>
</div>
<p>Output files will be written in the <cite>out</cite> subdirectory. The <cite>*.py</cite> files can be visualized by running <code class="docutils literal notranslate"><span class="pre">plot</span></code>. The written rhs vector in poisson_rhs_000.txt  is the weak form of the rhs!</p>
<figure class="align-default" id="id23">
<span id="poisson1d-1"></span><a class="reference internal image-reference" href="../_images/poisson1d_1.png"><img alt="../_images/poisson1d_1.png" src="../_images/poisson1d_1.png" style="width: 40%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 18 </span><span class="caption-text">Scenario (1).</span><a class="headerlink" href="#id23" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="poisson2d">
<h3>poisson2d<a class="headerlink" href="#poisson2d" title="Link to this heading"></a></h3>
<p>This solves the 2D poisson equation with a given right hand side,</p>
<div class="math notranslate nohighlight">
\[Δu = f\]</div>
<p>This is very similar to the Laplace example.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/poisson/poisson2d
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>Possible scenarios:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./poisson_example<span class="w"> </span>../settings_2d.py<span class="w">      </span><span class="c1"># (1)</span>
</pre></div>
</div>
<p>Output files will be written in the <cite>out</cite> subdirectory. The <cite>*.py</cite> files can be visualized by running <code class="docutils literal notranslate"><span class="pre">plot</span></code>. The written rhs vector in poisson_rhs_000.txt  is the weak form of the rhs!</p>
<figure class="align-default" id="id24">
<span id="poisson2d-1"></span><a class="reference internal image-reference" href="../_images/poisson2d_1.png"><img alt="../_images/poisson2d_1.png" src="../_images/poisson2d_1.png" style="width: 40%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 19 </span><span class="caption-text">Scenario (1).</span><a class="headerlink" href="#id24" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="diffusion">
<h2>Diffusion<a class="headerlink" href="#diffusion" title="Link to this heading"></a></h2>
<p>This solves the diffusion equation</p>
<div class="math notranslate nohighlight">
\[u_t - c\cdot Δu = 0\]</div>
<p>again with Dirichlet or Neumann-type boundary conditions and different initial values. There are again versions for different dimensionalities, <cite>diffusion1d</cite>, <cite>diffusion2d</cite> and  diffusion3d`.</p>
<section id="diffusion1d">
<h3>diffusion1d<a class="headerlink" href="#diffusion1d" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/diffusion/diffusion1d
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>Possible scenarios:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./diffusion_1d<span class="w"> </span>../settings_diffusion.py<span class="w">      </span><span class="c1"># (1)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/diffusion1d_1.png" id="diffusion1d-1"><img alt="../_images/diffusion1d_1.png" id="diffusion1d-1" src="../_images/diffusion1d_1.png" style="width: 40%;" /></a>
<a class="reference internal image-reference" href="../_images/diffusion1d_2.png"><img alt="../_images/diffusion1d_2.png" src="../_images/diffusion1d_2.png" style="width: 40%;" /></a>
<p>Fig. First and last time step.</p>
</section>
<section id="diffusion2d">
<h3>diffusion2d<a class="headerlink" href="#diffusion2d" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/diffusion/diffusion2d
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>Possible scenarios:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./diffusion2d_1st_order<span class="w"> </span>../settings_1st_order.py<span class="w">      </span><span class="c1"># (1)</span>
./diffusion2d_2nd_order<span class="w"> </span>../settings_2nd_order.py<span class="w">      </span><span class="c1"># (2)</span>
</pre></div>
</div>
<p>If you run <code class="docutils literal notranslate"><span class="pre">plot</span></code> in the <code class="docutils literal notranslate"><span class="pre">out</span></code> folder it will show an animation. It is also possible to view the result in ParaView.</p>
<figure class="align-default" id="id25">
<span id="diffusion2d-1"></span><a class="reference internal image-reference" href="../_images/diffusion2d_1.png"><img alt="../_images/diffusion2d_1.png" src="../_images/diffusion2d_1.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 20 </span><span class="caption-text">Scenario (1), linear ansatz functions.</span><a class="headerlink" href="#id25" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id26">
<span id="diffusion2d-2"></span><a class="reference internal image-reference" href="../_images/diffusion2d_2.png"><img alt="../_images/diffusion2d_2.png" src="../_images/diffusion2d_2.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 21 </span><span class="caption-text">Scenario (2), quadratic ansatz functions.</span><a class="headerlink" href="#id26" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="diffusion3d">
<h3>diffusion3d<a class="headerlink" href="#diffusion3d" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/diffusion/diffusion3d
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>Possible scenarios:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./diffusion<span class="w"> </span>../settings.py<span class="w">      </span><span class="c1"># (1)</span>
</pre></div>
</div>
<figure class="align-default" id="id27">
<span id="diffusion3d-1"></span><a class="reference internal image-reference" href="../_images/diffusion3d_1.png"><img alt="../_images/diffusion3d_1.png" src="../_images/diffusion3d_1.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 22 </span><span class="caption-text">Scenario (1). Left: initial value, right: final value (volume rendering).</span><a class="headerlink" href="#id27" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="anisotropic-diffusion">
<h3>anisotropic_diffusion<a class="headerlink" href="#anisotropic-diffusion" title="Link to this heading"></a></h3>
<p>This solves the diffusion equation</p>
<div class="math notranslate nohighlight">
\[u_t - \nabla\cdot \textbf{C} \nabla u = 0\]</div>
<p>with diffusion tensor <span class="math notranslate nohighlight">\(\textbf{C}\)</span>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/diffusion/diffusion3d
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>Possible scenarios:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./anisotropic_diffusion2d<span class="w"> </span>../settings2d.py<span class="w">              </span><span class="c1"># (1)</span>
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./anisotropic_diffusion2d<span class="w"> </span>../settings2d.py<span class="w">  </span><span class="c1"># (2)</span>
</pre></div>
</div>
<p>This uses a multigrid solver of Petsc.</p>
<figure class="align-default" id="id28">
<span id="anisotropic-diffusion3d-1"></span><a class="reference internal image-reference" href="../_images/anisotropic_diffusion_1.png"><img alt="../_images/anisotropic_diffusion_1.png" src="../_images/anisotropic_diffusion_1.png" style="width: 40%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 23 </span><span class="caption-text">Scenarios (1) and (2) produce the same results. By comparing with <a class="reference internal" href="#diffusion2d-2"><span class="std std-numref">Fig. 21</span></a> it can be clearly seen that this is anisotropic.</span><a class="headerlink" href="#id28" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="reaction-diffusion2d">
<h3>reaction_diffusion2d<a class="headerlink" href="#reaction-diffusion2d" title="Link to this heading"></a></h3>
<p>This solves the diffusion equation with source term</p>
<div class="math notranslate nohighlight">
\[u_t - cΔu = f(t)\]</div>
<p>with a source function <span class="math notranslate nohighlight">\(f(x,t)\)</span>. This function defined in the python settings as callback function. This example demonstrates how to use the <cite>PrescribedValues</cite> class.</p>
<p>(Actually this is not a reaction diffusion equation, because <span class="math notranslate nohighlight">\(f\)</span> does not depend on <span class="math notranslate nohighlight">\(u\)</span>.)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/diffusion/reaction_diffusion2d
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>Possible scenarios:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./reaction_diffusion_2d<span class="w"> </span>../settings_reaction_diffusion2d.py<span class="w">              </span><span class="c1"># (1)</span>
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./reaction_diffusion_2d<span class="w"> </span>../settings_reaction_diffusion2d.py<span class="w">  </span><span class="c1"># (2)</span>
</pre></div>
</div>
<figure class="align-default" id="id29">
<span id="reaction-diffusion2d-1"></span><a class="reference internal image-reference" href="../_images/reaction_diffusion2d_1.png"><img alt="../_images/reaction_diffusion2d_1.png" src="../_images/reaction_diffusion2d_1.png" style="width: 40%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 24 </span><span class="caption-text">Scenarios (1) and (2) produce the same results. Here, it makes sense to run <code class="docutils literal notranslate"><span class="pre">plot</span></code> in the <code class="docutils literal notranslate"><span class="pre">out</span></code> folder, to see the animation. The small peak at <span class="math notranslate nohighlight">\((0.55,0.25)\)</span> diffuses away, the callback function places a constant source at around <span class="math notranslate nohighlight">\((2.8,2.8)\)</span> which leads to the new maximum in the last timestep.</span><a class="headerlink" href="#id29" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="pint-diffusion1d">
<h3>PinT_diffusion1d<a class="headerlink" href="#pint-diffusion1d" title="Link to this heading"></a></h3>
<p>1D diffusion problem using the parallel-in-time algorithm “Multigrid reduction in time” (MGRIT) for the solution. This was done in the master thesis of Marius Nitzsche.</p>
</section>
</section>
<section id="fiber-tracing">
<h2>Fiber Tracing<a class="headerlink" href="#fiber-tracing" title="Link to this heading"></a></h2>
<section id="parallel-fiber-estimation">
<h3>parallel_fiber_estimation<a class="headerlink" href="#parallel-fiber-estimation" title="Link to this heading"></a></h3>
<p>Functionality to create fiber geometry for the Biceps Brachii muscle from a surface mesh of the muscle. This is very sophisticated and can be run in parallel.</p>
<p>This is the parallel algorithm that creates the fiber meshes. Input is an STL mesh of the surface of the muscle volume. Output is a <cite>*.bin</cite> file of the mesh.</p>
<p>Use the following commands to compile the program:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/fiber_tracing/parallel_fiber_estimation/build_debug
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>If the program is compiled for the debug target, additional output files will be created during the run.</p>
<p>The program can be run as follows. It takes several command arguments.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># arguments: &lt;splines_or_stl&gt; &lt;refinement&gt; &lt;improve_mesh&gt; &lt;use_gradient_field&gt; &lt;use_neumann_bc&gt;</span>
./generate<span class="w"> </span>../settings/settings.py<span class="w"> </span>splines<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="nb">false</span>
</pre></div>
</div>
<p><em>splines_or_stl</em></p>
<blockquote>
<div><p>Which input file to choose. If set to <code class="docutils literal notranslate"><span class="pre">splines</span></code>, the input file is <code class="docutils literal notranslate"><span class="pre">../../../electrophysiology/input/biceps.surface.pickle</span></code>, otherwise it is <code class="docutils literal notranslate"><span class="pre">../../../electrophysiology/input/biceps_splines.stl</span></code>.</p>
</div></blockquote>
<p><em>refinement</em></p>
<blockquote>
<div><p>(Integer), how to refine the mesh prior to solving the Laplace problem. 1 means no refinement, 2 means half the mesh width, 3 third mesh width etc.</p>
</div></blockquote>
<p><em>improve_mesh</em></p>
<blockquote>
<div><p>Either <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>. If the 2D meshes on the slices should be smoothed, i.e. improved. If true, it takes longer but gives better results.</p>
</div></blockquote>
<p><em>use_gradient_field</em></p>
<blockquote>
<div><p>Either <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>. If the tracing implementation using explicit gradient fields should be used.</p>
</div></blockquote>
<p><em>use_neumann_bc</em></p>
<blockquote>
<div><p>Either <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>. If Neumann boundary conditions should be used for the Laplacian potential flow problem. If not, Dirichlet boundary conditions are used.</p>
</div></blockquote>
</section>
<section id="streamline-tracer">
<h3>streamline_tracer<a class="headerlink" href="#streamline-tracer" title="Link to this heading"></a></h3>
</section>
</section>
<section id="solid-mechanics">
<h2>Solid Mechanics<a class="headerlink" href="#solid-mechanics" title="Link to this heading"></a></h2>
<section id="linear-elasticity">
<h3>Linear Elasticity<a class="headerlink" href="#linear-elasticity" title="Link to this heading"></a></h3>
<p>For scenarios (1) and (2), this solves linear elasticity</p>
<div class="math notranslate nohighlight">
\[\textbf{C}Δ\textbf{u} = \textbf{f}, \textbf{C} \in \mathbb{R}^2\times\mathbb{R}^2, \textbf{u}, \textbf{f} \in \mathbb{R}^2\]</div>
<p>The 4th order elasticity tensor has the entries</p>
<div class="math notranslate nohighlight">
\[C_{abcd} = K \delta_{ab}  \delta_{cd} + \mu \big(\delta_{ac}  \delta_{bd} + \delta_{ad}  \delta_{bc} - \dfrac{2}{3}  \delta_{ab} \delta_{cd}\big)\]</div>
<p>with shear modulus <span class="math notranslate nohighlight">\(\mu\)</span> and bulk modulus <span class="math notranslate nohighlight">\(K\)</span>.
It shows how the normal <cite>FiniteElementMethod</cite> class can be used for this problem.</p>
<p>For scenarios (3), (4) and (5), an active stress term is additionally considered, such that the 2nd Piola-Kirchhoff stress tensor is given as <span class="math notranslate nohighlight">\(S = S_\text{passive} + S_\text{active}\)</span>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/solid_mechanics/linear_elasticity/box
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
./linear_elasticity_2d<span class="w"> </span>../settings_linear_elasticity_2d.py<span class="w">    </span><span class="c1"># (1)</span>
./linear_elasticity_3d<span class="w"> </span>../settings_linear_elasticity_3d.py<span class="w">    </span><span class="c1"># (2)</span>

<span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/solid_mechanics/linear_elasticity/with_3d_activation
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
./lin_elasticity_with_3d_activation_linear<span class="w"> </span>../settings.py<span class="w">     </span><span class="c1"># (3)</span>
./lin_elasticity_with_3d_activation_quadratic<span class="w"> </span>../settings.py<span class="w">  </span><span class="c1"># (4) does not converge</span>

<span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/solid_mechanics/linear_elasticity/with_fiber_activation
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
./lin_elasticity_with_fibers<span class="w"> </span>../settings_fibers.py<span class="w">            </span><span class="c1"># (5)</span>
</pre></div>
</div>
<figure class="align-default" id="id30">
<span id="linear-elasticity-1"></span><a class="reference internal image-reference" href="../_images/linear_elasticity_1.png"><img alt="../_images/linear_elasticity_1.png" src="../_images/linear_elasticity_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 25 </span><span class="caption-text">Scenario (1): Neumann boundary conditions as black arrows (traction). This has been visualized using Arrow Glyphs and Warp filters in ParaView.</span><a class="headerlink" href="#id30" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id31">
<span id="linear-elasticity-2"></span><a class="reference internal image-reference" href="../_images/linear_elasticity_2.png"><img alt="../_images/linear_elasticity_2.png" src="../_images/linear_elasticity_2.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 26 </span><span class="caption-text">Scenario (2): Neumann boundary conditions as black arrows (traction). This has been visualized using Arrow Glyphs and Warp filters in ParaView.</span><a class="headerlink" href="#id31" title="Link to this image"></a></p>
</figcaption>
</figure>
<a class="reference internal image-reference" href="../_images/linear_elasticity_3_1.png" id="linear-elasticity-3"><img alt="../_images/linear_elasticity_3_1.png" id="linear-elasticity-3" src="../_images/linear_elasticity_3_1.png" style="width: 24%;" /></a>
<a class="reference internal image-reference" href="../_images/linear_elasticity_3_2.png"><img alt="../_images/linear_elasticity_3_2.png" src="../_images/linear_elasticity_3_2.png" style="width: 24%;" /></a>
<a class="reference internal image-reference" href="../_images/linear_elasticity_3_3.png"><img alt="../_images/linear_elasticity_3_3.png" src="../_images/linear_elasticity_3_3.png" style="width: 24%;" /></a>
<a class="reference internal image-reference" href="../_images/linear_elasticity_3_4.png"><img alt="../_images/linear_elasticity_3_4.png" src="../_images/linear_elasticity_3_4.png" style="width: 24%;" /></a>
<p>Scenario (3): This is a dynamic problem. An active stress value is prescribed over time in the 3D mesh and used in the elasticity computation. This simulates a periodically contracting muscle.</p>
<a class="reference internal image-reference" href="../_images/linear_elasticity_5_1.png" id="linear-elasticity-5"><img alt="../_images/linear_elasticity_5_1.png" id="linear-elasticity-5" src="../_images/linear_elasticity_5_1.png" style="width: 49%;" /></a>
<a class="reference internal image-reference" href="../_images/linear_elasticity_5_2.png"><img alt="../_images/linear_elasticity_5_2.png" src="../_images/linear_elasticity_5_2.png" style="width: 49%;" /></a>
<p>Scenario (5): An active stress value is prescribed over time at multiple 1D fibers (shown as spheres). This value gets mapped to the 3D mesh and used in the elasticity computation. This can also be seen as muscle tissue, which is bending up and down periodically.</p>
</section>
<section id="mooney-rivlin-isotropic">
<h3>Mooney-Rivlin isotropic<a class="headerlink" href="#mooney-rivlin-isotropic" title="Link to this heading"></a></h3>
<p>Solves a static 3D nonlinear, incompressible solid mechanics problem with Mooney-Rivlin material. The strain energy function is formulated using the reduced invariants as follows.</p>
<div class="math notranslate nohighlight">
\[Ψ_\text{iso}(\bar{I},\bar{I}_2) = c_1 (\bar{I}_1 - 3) + c_2 (\bar{I}_2 - 3)\]</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/solid_mechanics/mooney_rivlin_isotropic
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>Possible scenarios:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./3d_hyperelasticity<span class="w"> </span>../settings_3d_box.py<span class="w">      </span><span class="c1"># (1)</span>
./3d_hyperelasticity<span class="w"> </span>../settings_3d_muscle.py<span class="w">   </span><span class="c1"># (2)</span>
</pre></div>
</div>
<figure class="align-default" id="id32">
<span id="mooney-rivlin-isotropic-1"></span><a class="reference internal image-reference" href="../_images/mooney_rivlin_isotropic_1.png"><img alt="../_images/mooney_rivlin_isotropic_1.png" src="../_images/mooney_rivlin_isotropic_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 27 </span><span class="caption-text">Scenario (1): A deformed box, material parameters <span class="math notranslate nohighlight">\(c_1=0, c_2=1\)</span>. The box is fixed at the left plane. The arrows visualize the traction.</span><a class="headerlink" href="#id32" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id33">
<span id="mooney-rivlin-isotropic-2"></span><a class="reference internal image-reference" href="../_images/mooney_rivlin_isotropic_2.png"><img alt="../_images/mooney_rivlin_isotropic_2.png" src="../_images/mooney_rivlin_isotropic_2.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 28 </span><span class="caption-text">Scenario (2): A deformed muscle geometry. Material parameters <span class="math notranslate nohighlight">\(c_1 = 3.176e-10, c_2 = 1.813\)</span> [N/cm^2]. The muscle is fixed at the top end, a force acts at the bottom end.</span><a class="headerlink" href="#id33" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id34">
<span id="mooney-rivlin-isotropic-3"></span><a class="reference internal image-reference" href="../_images/mooney_rivlin_isotropic_3.png"><img alt="../_images/mooney_rivlin_isotropic_3.png" src="../_images/mooney_rivlin_isotropic_3.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 29 </span><span class="caption-text">The residual norm of the nonlinear solver over time steps. The Jacobian matrix is formed analytically every 5th iteration, in total three times (before iterations 1, 6, 11). It can be seen that the residual norm drops after every new Jacobian and then only increases a little more.</span><a class="headerlink" href="#id34" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="mooney-rivlin-transiso">
<h3>Mooney-Rivlin transiso<a class="headerlink" href="#mooney-rivlin-transiso" title="Link to this heading"></a></h3>
<dl class="simple">
<dt>Solves a static 3D nonlinear solid mechanics problem, now with transversely isotropic Mooney-Rivlin material, i.e. with 4 material parameters.</dt><dd><p>The strain energy function is formulated using the reduced invariants as follows.</p>
</dd>
</dl>
<div class="math notranslate nohighlight">
\[\begin{split}Ψ_\text{iso}(\bar{I},\bar{I}_2,\bar{I}_4,\bar{I}_5)
  = c_1 (\bar{I}_1 - 3) + c_2 (\bar{I}_2 - 3) + \dfrac{b}{d} (\lambda^d - 1) - b\,ln(\lambda),\\
   \lambda = \sqrt{\bar{I}_4}\end{split}\]</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/solid_mechanics/mooney_rivlin_transiso
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>Possible scenarios:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./3d_hyperelasticity<span class="w"> </span>../settings_3d_box.py<span class="w">      </span><span class="c1"># (1)</span>
./3d_hyperelasticity<span class="w"> </span>../settings_3d_muscle.py<span class="w">   </span><span class="c1"># (2)</span>
</pre></div>
</div>
<figure class="align-default" id="id35">
<span id="mooney-rivlin-transiso-1"></span><a class="reference internal image-reference" href="../_images/mooney_rivlin_transiso_1.png"><img alt="../_images/mooney_rivlin_transiso_1.png" src="../_images/mooney_rivlin_transiso_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 30 </span><span class="caption-text">Scenario (1): A deformed box. The box is fixed at the left plane, it contains diagonal internal fibers that are oriented by 40 degrees away from the center line. Material parameters are <span class="math notranslate nohighlight">\(c_1=2, c_2=3, b_1=4, d_1=5\)</span>. The rod is only pulled towards the right, not to the bottom. The displacements are enlarged by the factor 10. It can be seen that by the anistropic material, it behaves asymmetrically.</span><a class="headerlink" href="#id35" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id36">
<span id="mooney-rivlin-transiso-2"></span><a class="reference internal image-reference" href="../_images/mooney_rivlin_transiso_2.png"><img alt="../_images/mooney_rivlin_transiso_2.png" src="../_images/mooney_rivlin_transiso_2.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 31 </span><span class="caption-text">Scenario (2): A deformed muscle geometry, material parameters <span class="math notranslate nohighlight">\(c_1 = 3.176e-10, c_2 = 1.813, b  = 1.075e-2, d  = 9.1733\)</span>. The muscle is fixed at the left end and pulled upwards by a force of 0.1 N.</span><a class="headerlink" href="#id36" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="dynamic-mooney-rivlin">
<h3>Dynamic Mooney-Rivlin<a class="headerlink" href="#dynamic-mooney-rivlin" title="Link to this heading"></a></h3>
<p>The following examples are contained under the <cite>dynamic_mooney_rivlin</cite> directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/solid_mechanics/dynamic_mooney_rivlin/rod
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
./dynamic_transversely_isotropic<span class="w"> </span>../settings_dynamic.py<span class="w">    </span><span class="c1"># (1)</span>

<span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/solid_mechanics/dynamic_mooney_rivlin/gelatine1
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
./dynamic<span class="w"> </span>../settings_gelatine1.py<span class="w">              </span><span class="c1"># (2)</span>

<span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/solid_mechanics/dynamic_mooney_rivlin/gelatine2
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
./dynamic<span class="w"> </span>../settings_gelatine2.py<span class="w">              </span><span class="c1"># (3)</span>

<span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/solid_mechanics/dynamic_mooney_rivlin/muscle
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
./dynamic_transversely_isotropic<span class="w"> </span>../settings_muscle.py<span class="w">    </span><span class="c1"># (4)</span>

<span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/solid_mechanics/dynamic_mooney_rivlin/muscle_with_fat
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>./muscle_with_fat<span class="w"> </span>../settings_muscle_with_fat.py<span class="w"> </span>coarse.py<span class="w">    </span><span class="c1"># (5)</span>

<span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/solid_mechanics/dynamic_mooney_rivlin/tendon
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
./tendon<span class="w"> </span>../settings_tendon.py<span class="w"> </span>tendon_bottom<span class="w">    </span><span class="c1"># (6)</span>
./tendon<span class="w"> </span>../settings_tendon.py<span class="w"> </span>tendon_top_a<span class="w">     </span><span class="c1"># (7)</span>
./tendon<span class="w"> </span>../settings_tendon.py<span class="w"> </span>tendon_top_b<span class="w">     </span><span class="c1"># (8)</span>
</pre></div>
</div>
<iframe width="600" height="400" src="https://www.youtube.com/embed/RcehAfDiD-k" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><p>Scenario (1)</p>
<a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_2_1.png" id="dynamic-mooney-rivlin-2"><img alt="../_images/dynamic_mooney_rivlin_2_1.png" id="dynamic-mooney-rivlin-2" src="../_images/dynamic_mooney_rivlin_2_1.png" style="width: 13%;" /></a>
<a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_2_2.png"><img alt="../_images/dynamic_mooney_rivlin_2_2.png" src="../_images/dynamic_mooney_rivlin_2_2.png" style="width: 13%;" /></a>
<a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_2_3.png"><img alt="../_images/dynamic_mooney_rivlin_2_3.png" src="../_images/dynamic_mooney_rivlin_2_3.png" style="width: 13%;" /></a>
<a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_2_4.png"><img alt="../_images/dynamic_mooney_rivlin_2_4.png" src="../_images/dynamic_mooney_rivlin_2_4.png" style="width: 13%;" /></a>
<a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_2_5.png"><img alt="../_images/dynamic_mooney_rivlin_2_5.png" src="../_images/dynamic_mooney_rivlin_2_5.png" style="width: 13%;" /></a>
<a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_2_6.png"><img alt="../_images/dynamic_mooney_rivlin_2_6.png" src="../_images/dynamic_mooney_rivlin_2_6.png" style="width: 13%;" /></a>
<a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_2_7.png"><img alt="../_images/dynamic_mooney_rivlin_2_7.png" src="../_images/dynamic_mooney_rivlin_2_7.png" style="width: 13%;" /></a>
<p>Scenario (2): A piece of gelatine the gets moved to the right. This is realized with Dirichlet boundary conditions that can be updated over time by a python callback function.</p>
<p>With this scenario, we can demonstrate the effect of the option <code class="docutils literal notranslate"><span class="pre">extrapolateInitialGuess</span></code>. It controls whether the initial guess for the vector of unknowns in the dynamic solid mechanics problem is extrapolated from the two previous time steps.</p>
<p>We consider a simulation until <span class="math notranslate nohighlight">\(t=10\)</span> (set <code class="docutils literal notranslate"><span class="pre">end_time</span> <span class="pre">=</span> <span class="pre">10</span></code> in <code class="docutils literal notranslate"><span class="pre">settings_gelatine1.py</span></code>).
At timestep 19 (<span class="math notranslate nohighlight">\(t=9.5\)</span>), we observe the following behaviour:</p>
<table class="docutils align-default" id="id37">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">Effect of extrapolating the initial guess</span><a class="headerlink" href="#id37" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">&quot;extrapolateInitialGuess&quot;:</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">False</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">True</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Initial residuum at <span class="math notranslate nohighlight">\(t=9.5\)</span></p></td>
<td><p>8.07862</p></td>
<td><p>1.80136</p></td>
</tr>
<tr class="row-odd"><td><p>Number of Newton iterations <cite>*)</cite></p></td>
<td><p>5</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>Wall user time of the entire simulation</p></td>
<td><p>52 s</p></td>
<td><p>40 s</p></td>
</tr>
</tbody>
</table>
<p><cite>*)</cite>:  Number of Newton iterations of the
dynamic problem at <span class="math notranslate nohighlight">\(t=9.5\)</span>, until the absolute error is below 1e-5.</p>
<a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_3_1.png" id="dynamic-mooney-rivlin-3"><img alt="../_images/dynamic_mooney_rivlin_3_1.png" id="dynamic-mooney-rivlin-3" src="../_images/dynamic_mooney_rivlin_3_1.png" style="width: 13%;" /></a>
<a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_3_2.png"><img alt="../_images/dynamic_mooney_rivlin_3_2.png" src="../_images/dynamic_mooney_rivlin_3_2.png" style="width: 13%;" /></a>
<a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_3_3.png"><img alt="../_images/dynamic_mooney_rivlin_3_3.png" src="../_images/dynamic_mooney_rivlin_3_3.png" style="width: 13%;" /></a>
<a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_3_4.png"><img alt="../_images/dynamic_mooney_rivlin_3_4.png" src="../_images/dynamic_mooney_rivlin_3_4.png" style="width: 13%;" /></a>
<a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_3_5.png"><img alt="../_images/dynamic_mooney_rivlin_3_5.png" src="../_images/dynamic_mooney_rivlin_3_5.png" style="width: 13%;" /></a>
<a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_3_6.png"><img alt="../_images/dynamic_mooney_rivlin_3_6.png" src="../_images/dynamic_mooney_rivlin_3_6.png" style="width: 13%;" /></a>
<a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_3_7.png"><img alt="../_images/dynamic_mooney_rivlin_3_7.png" src="../_images/dynamic_mooney_rivlin_3_7.png" style="width: 13%;" /></a>
<p>Scenario (3): A piece of gelatine moves from a varying force, this time in the longer direction of the hexaeder. This is realized with a traction force on the bottom that changes according to a sin function. This is a Neumann boundary condition that gets updated over time by a python callback function. The arrows visualize the current velocity vectors.</p>
<figure class="align-default" id="id38">
<span id="dynamic-mooney-rivlin-4"></span><a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_4.png"><img alt="../_images/dynamic_mooney_rivlin_4.png" src="../_images/dynamic_mooney_rivlin_4.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 32 </span><span class="caption-text">Scenario (4): Dynamic simulation of muscle without active stress. The arrows indicate the velocity, colorung of the muscle volume is the 2nd Piola-Kirchhoff stress.</span><a class="headerlink" href="#id38" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id39">
<span id="dynamic-mooney-rivlin-5"></span><a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_5.png"><img alt="../_images/dynamic_mooney_rivlin_5.png" src="../_images/dynamic_mooney_rivlin_5.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 33 </span><span class="caption-text">Scenario (5): Dynamic simulation of muscle with fat layer, active stress is prescribed in the muscle domain.</span><a class="headerlink" href="#id39" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id40">
<span id="dynamic-mooney-rivlin-6"></span><a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_6.png"><img alt="../_images/dynamic_mooney_rivlin_6.png" src="../_images/dynamic_mooney_rivlin_6.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 34 </span><span class="caption-text">Scenario (6), the bottom tendon.</span><a class="headerlink" href="#id40" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id41">
<span id="dynamic-mooney-rivlin-7"></span><a class="reference internal image-reference" href="../_images/dynamic_mooney_rivlin_7.png"><img alt="../_images/dynamic_mooney_rivlin_7.png" src="../_images/dynamic_mooney_rivlin_7.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 35 </span><span class="caption-text">Scenarios (7) and (8), the two top tendons.</span><a class="headerlink" href="#id41" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Scenarios (6), (7) and (8) use the tendon material from <a class="reference external" href="https://www.sciencedirect.com/science/article/abs/pii/S0021929017300726">Carniel, T. A., &amp; Fancello, E. A. (2017). A transversely isotropic coupled hyperelastic model for the mechanical behavior of tendons. Journal of biomechanics, 54, 49-57.</a></p>
</section>
<section id="custom-material">
<h3>Custom Material<a class="headerlink" href="#custom-material" title="Link to this heading"></a></h3>
<p>This is a template example that shows how a custom material, given by its strain energy function, can be used.
The material can be defined in the C++ source file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/solid_mechanics/custom_material/
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>Possible scenarios:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./material_a_static<span class="w"> </span>../settings_static.py<span class="w">     </span><span class="c1"># (1)</span>
./material_a_dynamic<span class="w"> </span>../settings_dynamic.py<span class="w">   </span><span class="c1"># (2)</span>
</pre></div>
</div>
<p>The first scenario is static the second is dynamic. It can also be run in parallel by prepending e.g. <cite>mpirun -n 2</cite>.
How to specify the material is described in <a class="reference internal" href="../settings/hyperelasticity.html#strain-energy-function"><span class="std std-ref">Specification of the strain energy function</span></a>.</p>
</section>
<section id="mooney-rivlin-with-febio">
<h3>Mooney-Rivlin with FEBio<a class="headerlink" href="#mooney-rivlin-with-febio" title="Link to this heading"></a></h3>
<p>This example uses <a class="reference external" href="https://febio.org/">FEBio</a> to compute deformation of a Mooney-Rivlin material.
The same scenario is also simulated with opendihu and the results are compared.</p>
<p>This example needs FEBio installed. More specifically, you need to ensure that <code class="docutils literal notranslate"><span class="pre">febio3</span></code> runs the febio executable</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/solid_mechanics/mooney_rivlin_febio
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
./febio<span class="w"> </span>../settings_both.py
./opendihu<span class="w"> </span>../settings_both.py
</pre></div>
</div>
<p>After running both programs (<cite>./febio</cite> and <cite>./opendihu</cite>) there should be an output like</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rms:<span class="w"> </span><span class="m">2</span>.5842881150700362e-06
</pre></div>
</div>
<p>This is the root mean square error between both results. If it is small like this, the results match.</p>
<p>If you get a message <code class="docutils literal notranslate"><span class="pre">Error:</span> <span class="pre">Running</span> <span class="pre">febio</span> <span class="pre">failed</span> <span class="pre">with</span> <span class="pre">error</span> <span class="pre">code</span> <span class="pre">256</span></code>, then febio is not installed or something failed with febio.</p>
<figure class="align-default" id="id42">
<span id="mooney-rivlin-febio-1"></span><a class="reference internal image-reference" href="../_images/mooney_rivlin_febio_1.png"><img alt="../_images/mooney_rivlin_febio_1.png" src="../_images/mooney_rivlin_febio_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 36 </span><span class="caption-text">Scenario for comparison of the results of FEBio and opendihu: The initial block (black lines) is extended to the right by a force. The result of opendihu is visualized by white tubes, the result of FEBio is visualized by the green solid. The results match.</span><a class="headerlink" href="#id42" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="tensile-test">
<h3>Tensile Test<a class="headerlink" href="#tensile-test" title="Link to this heading"></a></h3>
<p>This example simulates a tensile test, where a block is extended uniaxially. The results for different materials are compared, also the same material with FEBio and opendihu.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/solid_mechanics/tensile_test
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
../run_force.sh
<span class="nb">cd</span><span class="w"> </span>..
./plot_force.py
</pre></div>
</div>
<p>The <cite>run_force.sh</cite> script executes all simulations that are required for the tensile test. The script <cite>plot_force.py</cite> creates a plot of all results.</p>
<p>The following materials are used:</p>
<ul>
<li><p>Compressible Mooney-Rivlin:</p>
<div class="math notranslate nohighlight">
\[\begin{split}Ψ(I_1,I_2,I_3) = c\,(\sqrt{I_3} - 1)^2 - d\cdot\ln(\sqrt{I_3}) + c_1\,(I_1 - 3) + c_2\,(I_2 - 3), \\
d = 2(c_1 + 2c_2)\end{split}\]</div>
</li>
<li><p>Compressible Mooney-Rivlin, decoupled form:</p>
<div class="math notranslate nohighlight">
\[\begin{split}Ψ_\text{iso}(\bar{I}_1,\bar{I}_2) = c_1 (\bar{I}_1 - 3) + c_2 (\bar{I}_2 - 3),\\
G = \dfrac{1}{4} \big(J^2 - 1 - 2\,\ln(J)\big),\\
Ψ_\text{vol} = \kappa \cdot G\end{split}\]</div>
</li>
<li><p>Nearly incompressible Mooney-Rivlin:</p>
<div class="math notranslate nohighlight">
\[\begin{split}Ψ(I_1,I_2,I_3) = \kappa\cdot (\sqrt{I_3} - 1)^2 - d\cdot \ln(\sqrt{I_3}) + c_1 (I_1 - 3) + c_2 (I_2 - 3),\\
d = 2(c_1 + 2c_2)\end{split}\]</div>
</li>
<li><p><a class="reference external" href="https://help.febio.org/FEBio/FEBio_um_2_9/FEBio_um_2-9-4.1.2.8.html#toc-Subsubsection-4.1.2.8">Nearly incompressible Mooney-Rivlin (FEBio)</a>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}Ψ_\text{iso}(\bar{I}_1,\bar{I}_2) = c_1 (\bar{I}_1 - 3) + c_2 (\bar{I}_2 - 3),\\
G = \dfrac{1}{2} \big(\ln(J)\big)^2,\\
Ψ_\text{vol} = \kappa \cdot G\end{split}\]</div>
</li>
<li><p>Nearly incompressible Mooney-Rivlin, decoupled form:</p>
<div class="math notranslate nohighlight">
\[\begin{split}Ψ_\text{iso}(\bar{I}_1,\bar{I}_2) = c_1 (\bar{I}_1 - 3) + c_2 (\bar{I}_2 - 3)
G = \dfrac{1}{4} \big(J^2 - 1 - 2\,ln(J)\big),\\
Ψ_\text{vol}(J) = \kappa \cdot G\end{split}\]</div>
</li>
<li><p>Incompressible Mooney-Rivlin:</p>
<div class="math notranslate nohighlight">
\[Ψ_\text{iso}(\bar{I}_1,\bar{I}_2) = c_1 (\bar{I}_1 - 3) + c_2 (\bar{I}_2 - 3)\]</div>
</li>
</ul>
<figure class="align-default" id="id43">
<span id="id2"></span><a class="reference internal image-reference" href="../_images/tensile_test_1.png"><img alt="../_images/tensile_test_1.png" src="../_images/tensile_test_1.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 37 </span><span class="caption-text">Result of the tensile test, stress-strain curves for different materials. It can be seen that for the incompressible material all the curves of the different formulations in opendihu and the curve for FEBio match and therefore the opendihu implementation is validated. The two compressible formulations cannot be compared because they have different parameters.</span><a class="headerlink" href="#id43" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="shear-test">
<h3>Shear Test<a class="headerlink" href="#shear-test" title="Link to this heading"></a></h3>
<p>This example simulates a shear test. The results for different materials are compared, the materials are the same as for the tensile test.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/solid_mechanics/shear_test
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
../run_force.sh
<span class="nb">cd</span><span class="w"> </span>..
./plot_force.py
</pre></div>
</div>
<p>The <cite>run_force.sh</cite> script executes all simulations that are required for the shear test. The script <cite>plot_force.py</cite> creates a plot of all results.</p>
<figure class="align-default" id="id44">
<span id="id3"></span><a class="reference internal image-reference" href="../_images/shear_test_1.png"><img alt="../_images/shear_test_1.png" src="../_images/shear_test_1.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 38 </span><span class="caption-text">Result of the shear test, stress-strain curves for different materials.</span><a class="headerlink" href="#id44" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="chaste">
<h3>Chaste<a class="headerlink" href="#chaste" title="Link to this heading"></a></h3>
<p>This example is for testing the Chaste integration in opendihu. It uses the hyperelasticity implementation of chaste if chaste has been installed.
It solves the nonlinear finite elasticity problem with Mooney-Rivlin material, for either 2D or 3D.</p>
<p>Because Chaste is not able to solve nonlinear elasticity in parallel, nor solve anything else than the quasi-static case,
integration in opendihu is not complete. This example is left here only if in the future someone wants to work on the chaste integration. Apart from that there is no use for Chaste.
In the core code it is only the <cite>QuasiStaticNonlinearElasticitySolverChaste</cite> that needs to be deleted.</p>
</section>
</section>
<section id="electrophysiology">
<h2>Electrophysiology<a class="headerlink" href="#electrophysiology" title="Link to this heading"></a></h2>
<p>The following examples use some of the models given by the schematic in <a class="reference internal" href="#model-schematic"><span class="std std-numref">Fig. 39</span></a>.</p>
<figure class="align-default" id="id45">
<span id="model-schematic"></span><a class="reference internal image-reference" href="../_images/model_schematic.svg"><img alt="../_images/model_schematic.svg" src="../_images/model_schematic.svg" width="100%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 39 </span><span class="caption-text">Complete schematic with all models.</span><a class="headerlink" href="#id45" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>All model equations are listed in the following.</p>
<ul>
<li><p>Monodomain equation, for one fiber:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\dfrac{\partial V_m}{\partial t} = \color{red}{\dfrac{\sigma_\text{eff}}{A_m\,C_m} \dfrac{\partial^2 V_m}{\partial s^2}} \color{orange}{- \dfrac{1}{C_m}\,I_\text{ion}(V_m, \textbf{y})}\\
\color{orange}{\textbf{y}(t) = g(V_m, \textbf{y}(t))}\end{split}\]</div>
</li>
<li><p>First and second Multidomain equation for compartments <span class="math notranslate nohighlight">\(k = 1, \dots, N_\text{MU}\)</span> as alternative to fibers:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\color{red}{\textrm{div}\big(\sigma_e \,\textrm{grad}( \phi_e)\big) + \sum\limits_{k=1}^{N_\text{MU}} f_r^k\,\textrm{div}\big(\sigma_i^k\,\textrm{grad}(\phi_i^k)\big)  = 0}\\
\color{red}{\textrm{div}\big(\sigma_i^k\,\textrm{grad}(\phi_i^k)\big)} = \color{orange}{ A_m^k\,\big(C_m^k \dfrac{\partial V_m^k}{\partial t} + I_\text{ion}(V_m^k, l_\text{HS}, \dot{l}_\text{HS}, \textbf{y}^k)\big),} \quad \forall k \in \{1, \dots, N_\text{MU}\}\\
\color{orange}{\textbf{y}^k(t) = g(V_m^k, \textbf{y}^k(t))} \quad \forall k \in \{1, \dots, N_\text{MU}\}\end{split}\]</div>
<p>Reference: <a class="reference external" href="https://link.springer.com/article/10.1007%2Fs10237-019-01214-5">Paper</a></p>
</li>
<li><p>Static Bidomain equation for EMG signals, solved in muscle domain and fat domain:</p>
<div class="math notranslate nohighlight">
\[\color{blue}{\textrm{div}\big((\sigma_i + \sigma_e)\,\textrm{grad}\,\phi_e\big) = -\textrm{div}(\sigma_i \textrm{grad}\,V_m)}\]</div>
</li>
<li><p>Dynamic, incompressible solid mechanics:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\color{green}{\delta W_\text{int}(\textbf{u},p) - \delta W_\text{ext}(\dot{\textbf{v}}) \qquad \forall \delta \textbf{u} }\\
\color{green}{\dot{\textbf{u}} = \textbf{v}}\\
\color{green}{\int\limits_\Omega \big(J(\textbf{u}) - 1\big) \,\delta p \,\mathrm{d} V = 0 \qquad \forall \delta p \quad \text{(incompressibility)}}\end{split}\]</div>
<p>Computation of the 2nd Piola-Kirchhoff stress, <span class="math notranslate nohighlight">\(\textbf{S}\)</span>, with passive and active contributions:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\color{green}{\textbf{S} = \textbf{S}_\text{isochor} + \textbf{S}_\text{volumetric} + \textbf{S}_\text{active},}\\
\color{green}{\textbf{S}_\text{active} = \dfrac{1}{\lambda_f} \cdot P_\text{max} \cdot f(\lambda_f / \lambda_\text{opt}) \cdot \gamma \cdot \textbf{a}_0 \otimes \textbf{a}_0}\\\end{split}\]</div>
<p>References: <a class="reference external" href="https://www.hindawi.com/journals/cmmm/2013/517287/">Muscle Material</a>,
<a class="reference external" href="https://www.sciencedirect.com/science/article/abs/pii/S0021929017300726">Tendon Material</a></p>
</li>
</ul>
<section id="subcellular-models">
<h3>Subcellular models<a class="headerlink" href="#subcellular-models" title="Link to this heading"></a></h3>
<p>The following subcellular models (“yellow equations”, see above) are available in the <code class="docutils literal notranslate"><span class="pre">$OPENDIHU_HOME/examples/electrophysiology/input</span></code> directory.</p>
<p>Models already used in OpenCMISS:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">new_slow_TK_2014_12_08.cellml</span></code></p>
<ul>
<li><p>Used by Thomas Heidlauf with OpenCMISS (scenario 3a, “MultiPhysStrain”, old tomo mechanics)</p></li>
<li><p>contained environments: <code class="docutils literal notranslate"><span class="pre">sternrios</span></code>, <code class="docutils literal notranslate"><span class="pre">wal_environment</span></code>, <code class="docutils literal notranslate"><span class="pre">razumova</span></code>, i.e., this is based on the Shorten model</p></li>
<li><p>couples <code class="docutils literal notranslate"><span class="pre">wal_environment/I_HH</span></code> and <code class="docutils literal notranslate"><span class="pre">razumova/L_S</span></code>, so there is no shortening velocity feedback</p></li>
<li><p>computes active stress: <code class="docutils literal notranslate"><span class="pre">razumova/stress</span></code></p></li>
<li><p>57 states and 71 algebraics</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Aliev_Panfilov_Razumova_2016_08_22.cellml</span></code></p>
<ul>
<li><p>Used by Thomas Heidlauf with OpenCMISS (scenario 3, “MultiPhysStrain”, numerically more stable)</p></li>
<li><p>contained environments: <code class="docutils literal notranslate"><span class="pre">Aliev_Panfilov</span></code>, <code class="docutils literal notranslate"><span class="pre">Razumova</span></code></p></li>
<li><p>couples <code class="docutils literal notranslate"><span class="pre">Aliev_Panfilov/I_HH</span></code> and <code class="docutils literal notranslate"><span class="pre">Razumova/velo</span></code> (<code class="docutils literal notranslate"><span class="pre">Razumova/l_hs</span></code> is available but not used internally)</p></li>
<li><p>computes no active stress</p></li>
<li><p>7 states and 12 algebraics</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Aliev_Panfilov_Razumova_Titin_2016_10_10_noFv.cellml</span></code></p>
<ul>
<li><p>Used by Thomas Heidlauf with OpenCMISS (scenario 4, “Titin”) and in the paper Heidlauf (2016) “A multi-scale continuum model of skeletal muscle mechanics predicting force enhancement based on actin–titin interaction”</p></li>
<li><p>contained environments: <code class="docutils literal notranslate"><span class="pre">Aliev_Panfilov</span></code>, <code class="docutils literal notranslate"><span class="pre">Razumova</span></code></p></li>
<li><p>couples <code class="docutils literal notranslate"><span class="pre">Aliev_Panfilov/I_HH</span></code>, <code class="docutils literal notranslate"><span class="pre">Razumova/l_hs</span></code> and <code class="docutils literal notranslate"><span class="pre">Razumova/rel_velo</span></code></p></li>
<li><p>computes active stress: <code class="docutils literal notranslate"><span class="pre">Razumova/ActiveStress</span></code>, the active stress is already multiplied by a force-velocity relation function <span class="math notranslate nohighlight">\(f_\ell(l_\text{hs}) = f_\ell(\lambda_f)\)</span>.</p></li>
<li><p>9 states and 8 algebraics</p></li>
</ul>
</li>
</ul>
<p>Other models:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hodgkin_huxley_1952.cellml</span></code></p>
<ul>
<li><p>The classical hodgkin huxley model with potassium channel and 2 sodium channels. This is sufficient for action potential propagation.</p></li>
<li><p>4 states and 9 algebraics</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">shorten_ocallaghan_davidson_soboleva_2007_no_stim.cellml</span></code></p>
<ul>
<li><p>contained environments: <code class="docutils literal notranslate"><span class="pre">razumova</span></code>, <code class="docutils literal notranslate"><span class="pre">sternrios</span></code>, <code class="docutils literal notranslate"><span class="pre">wal_environment</span></code>, i.e. the Shorten model</p></li>
<li><p>computes <code class="docutils literal notranslate"><span class="pre">razumova/activation</span></code> and <code class="docutils literal notranslate"><span class="pre">razumova/active_stress</span></code>, the active stress is already multiplied by a force-velocity relation function <span class="math notranslate nohighlight">\(f_\ell(l_\text{hs}) = f_\ell(\lambda_f)\)</span>.</p></li>
<li><p>Has inputs <code class="docutils literal notranslate"><span class="pre">razumova/l_hs</span></code> (fiber stretch) and <code class="docutils literal notranslate"><span class="pre">razumova/velocity</span></code> (contraction velocity).</p></li>
<li><p>58 states 77 algebraics</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Shorten_Titin_w_Fv_2016_08_23.cellml</span></code></p>
<ul>
<li><p>model cannot be viewed in OpenCOR</p></li>
<li><p>60 states and 72 algebraics</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">2020_06_03_hodgkin-huxley_shorten_ocallaghan_davidson_soboleva_2007.cellml</span></code></p>
<ul>
<li><p>This is a combination of the membrane model of Hodgkin-Huxley and the rest from Shorten. The rational is to have fatigue of Shorten but to make it faster using the simple Hodgkin-Huxley model for the membrane.</p></li>
<li><p>There are earlier versions that only differ in the initial values. This file has the correct initial values that are close to the equilibrium state.</p></li>
<li><p>contained environments: ( <code class="docutils literal notranslate"><span class="pre">leakage_current</span></code>, <code class="docutils literal notranslate"><span class="pre">membrane</span></code>, <code class="docutils literal notranslate"><span class="pre">potassium_channel</span></code>, <code class="docutils literal notranslate"><span class="pre">sodium_channel</span></code> = Hodgkin Huxley), <code class="docutils literal notranslate"><span class="pre">razumova</span></code>, <code class="docutils literal notranslate"><span class="pre">sternrios</span></code></p></li>
<li><p>computes <code class="docutils literal notranslate"><span class="pre">razumova/activation</span></code> and <code class="docutils literal notranslate"><span class="pre">razumova/active_stress</span></code>, the active stress is already multiplied by a force-velocity relation function <span class="math notranslate nohighlight">\(f_\ell(l_\text{hs}) = f_\ell(\lambda_f)\)</span>.</p></li>
<li><p>Has inputs <code class="docutils literal notranslate"><span class="pre">razumova/l_hs</span></code> (fiber stretch) and <code class="docutils literal notranslate"><span class="pre">razumova/velocity</span></code> (contraction velocity).</p></li>
<li><p>44 states and 19 algebraics</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">hodgkin_huxley-razumova.cellml</span></code></p>
<ul>
<li><p>This is a CellML model that computes activation and active stress values with only 9 states and 19 algebraics.</p></li>
<li><p>contained environments: (<code class="docutils literal notranslate"><span class="pre">leakage_current</span></code>, <code class="docutils literal notranslate"><span class="pre">membrane</span></code>, <code class="docutils literal notranslate"><span class="pre">potassium_channel</span></code>, <code class="docutils literal notranslate"><span class="pre">sodium_channel</span></code> = Hodgkin Huxley), <code class="docutils literal notranslate"><span class="pre">razumova</span></code></p></li>
<li><p>computes <code class="docutils literal notranslate"><span class="pre">Razumova/activation</span></code> and <code class="docutils literal notranslate"><span class="pre">Razumova/active_stress</span></code>, the active stress is already multiplied by a force-velocity relation function <span class="math notranslate nohighlight">\(f_\ell(l_\text{hs}) = f_\ell(\lambda_f)\)</span>.</p></li>
<li><p>Has input <code class="docutils literal notranslate"><span class="pre">Razumova/l_hs</span></code> (fiber stretch) and <code class="docutils literal notranslate"><span class="pre">Razumova/rel_velo</span></code> (contraction velocity).</p></li>
<li><p>9 states and 19 algebraics</p></li>
</ul>
</li>
</ul>
<p>Notes for the connections with the continuum mechanical model:</p>
<ul>
<li><p>Most CellML models compute an active stress that already has been multiplied by a force-velocity relation function <span class="math notranslate nohighlight">\(f_\ell(l_\text{hs}) = f_\ell(\lambda_f)\)</span>. This is done using the variable <code class="docutils literal notranslate"><span class="pre">l_hs</span></code> which is an input to the model. However, the structure as described in <a class="reference external" href="https://www.hindawi.com/journals/cmmm/2013/517287/">Heidlauf2013</a> is such that the CellML outputs the factor <span class="math notranslate nohighlight">\(\gamma \in [0,1]\)</span> which gets multiplied by <span class="math notranslate nohighlight">\(f_\ell(\lambda_f)\)</span> in the mechanics solver.</p>
<p>In OpenCMISS, there was no scaling in the mechanics solver and, therefore, it had to be in the CellML model. With OpenDiHu, both ways are possible:</p>
<ul class="simple">
<li><p>If the force-length relation should be considered in OpenDiHu and the mechanics solver, set <cite>“enableForceLengthRelation”: True</cite> and do not connect <code class="docutils literal notranslate"><span class="pre">l_hs</span></code> in the CellML model. Then, <span class="math notranslate nohighlight">\(l_{hs}=1 \Rightarrow f_\ell(l_\text{hs})=1\)</span>. OpenDiHu implements the quadratic equation of <a class="reference external" href="https://www.hindawi.com/journals/cmmm/2013/517287/">Heidlauf2013</a>.</p></li>
<li><p>If the force-length relation should be considered in the CellML model, set <cite>“enableForceLengthRelation”: False</cite> and connect the <code class="docutils literal notranslate"><span class="pre">l_hs</span></code> slot to the <code class="docutils literal notranslate"><span class="pre">lambda</span></code> output of the mechanics solver. This might be less efficient, because now lambda has to be transferred from opendihu to cellml, however it gives more flexibility because the force-length relation can be specified in the CellML model.</p></li>
</ul>
</li>
<li><p>The reverse connection from the mechanics solver to the subcellular model usually includes the contraction velocity or shortening velocity. Opendihu computes the derivative of the fiber stretch, <span class="math notranslate nohighlight">\(\dot{\lambda}_f\)</span>. This is a unit-less quantity. The CellML models need a value in micrometers per millisecond. The output of Opendihu can be scaled by the factor in option “lambdaDotScalingFactor” which is 1 by default. Some CellML models already do this scaling (those with <cite>rel_velo</cite>), then no rescaling is needed in opendihu.</p></li>
</ul>
</section>
<section id="cellml">
<h3>CellML<a class="headerlink" href="#cellml" title="Link to this heading"></a></h3>
<p>The directory <cite>examples/electrophysiology/cellml</cite> contains example that solve a single instance of a <a class="reference external" href="https://www.cellml.org/">CellML</a> model, i.e. the same thing that <a class="reference external" href="https://opencor.ws/">OpenCOR</a>  does.</p>
<figure class="align-default" id="model-schematic-cellml">
<a class="reference internal image-reference" href="../_images/model_schematic_cellml.svg"><img alt="../_images/model_schematic_cellml.svg" src="../_images/model_schematic_cellml.svg" width="100%" /></a>
</figure>
<p>A CellML model is a differential-algebraic system (DAE) stored in an XML-based description language. The <a class="reference internal" href="../settings/cellml_adapter.html"><span class="doc">CellMLAdapter</span></a> provides the following formulation:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\left(
  \begin{array}{cc}
    \texttt{rates} \\ \texttt{algebraics}
  \end{array}
\right) = \texttt{cellml}\left(\texttt{states}, \texttt{constants}\right).\end{split}\]</div>
<p>In general, the equation is</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{\partial \textbf{u}}{\partial t} = f(t,\textbf{u},\textbf{y}) \\
\textbf{y}(t) = g(\textbf{u}(t))\end{split}\]</div>
<section id="shorten">
<h4>Shorten<a class="headerlink" href="#shorten" title="Link to this heading"></a></h4>
<blockquote>
<div><p>Simulates a single instance of the Shorten 2007 problem for 10s. It is stimulated at time 0.0. Plots values of Vm and gamma in out.png.
Note, this uses a very fine timestep width of 1e-5 and explicit integration. This is only for debugging and demonstration, you
can replace the ExplicitEuler by, e.g., Heun integration</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/cellml/shorten
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
./cellml<span class="w"> </span>../settings_cellml.py
<span class="nb">cd</span><span class="w"> </span>out<span class="p">;</span><span class="w"> </span>plot
</pre></div>
</div>
<figure class="align-default" id="id46">
<span id="cellml-2"></span><a class="reference internal image-reference" href="../_images/cellml_2.png"><img alt="../_images/cellml_2.png" src="../_images/cellml_2.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 40 </span><span class="caption-text">This shows the depolarization of the membrane voltage over time in the top plot and all other states, scaled to [-1,1] in the bottom plot.</span><a class="headerlink" href="#id46" title="Link to this image"></a></p>
</figcaption>
</figure>
</div></blockquote>
</section>
<section id="hodgkin-huxley-shorten-ocallaghan-davidson-soboleva-2007">
<h4>hodgkin-huxley_shorten_ocallaghan_davidson_soboleva_2007<a class="headerlink" href="#hodgkin-huxley-shorten-ocallaghan-davidson-soboleva-2007" title="Link to this heading"></a></h4>
<blockquote>
<div><p>Solves this CellML model, can be used for electrophysiology with active stress generation.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/cellml/hodgkin-huxley_shorten_ocallaghan_davidson_soboleva_2007
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
./cellml<span class="w"> </span>../settings_cellml.py
<span class="nb">cd</span><span class="w"> </span>out<span class="p">;</span><span class="w"> </span>plot
</pre></div>
</div>
<figure class="align-default" id="id47">
<span id="cellml-1"></span><a class="reference internal image-reference" href="../_images/cellml_1.png"><img alt="../_images/cellml_1.png" src="../_images/cellml_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 41 </span><span class="caption-text">This shows the depolarization of the membrane voltage over time in the top plot and all other states, scaled to [-1,1] in the bottom plot.</span><a class="headerlink" href="#id47" title="Link to this image"></a></p>
</figcaption>
</figure>
</div></blockquote>
</section>
</section>
<section id="monodomain">
<h3>Monodomain<a class="headerlink" href="#monodomain" title="Link to this heading"></a></h3>
<figure class="align-default" id="id48">
<span id="model-schematic-monodomain"></span><a class="reference internal image-reference" href="../_images/model_schematic_monodomain.svg"><img alt="../_images/model_schematic_monodomain.svg" src="../_images/model_schematic_monodomain.svg" width="100%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 42 </span><span class="caption-text">Models for the examples with Monodomain equation.</span><a class="headerlink" href="#id48" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The Monodomain equation describes action potential propagation on a muscle fiber. It can be derived from modeling the intra and extracellular space and the membrane as an electric circuit. It is given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}\dfrac{\partial V_m}{\partial t} = \dfrac{1}{A_m\,C_m} \left( \sigma_\text{eff} \dfrac{\partial^2 V_m}{\partial x^2} - A_m\,I_\text{ion}(\textbf{y}, V_m, I_\text{stim})\right) \text{ for } x \in \Omega_f \subset \mathbb{R},\\
\textbf{y}(t) = g(\textbf{y}(t))\end{split}\]</div>
<ul class="simple">
<li><p>where <span class="math notranslate nohighlight">\(\Omega_f\)</span> is the fiber domain,</p></li>
<li><p><span class="math notranslate nohighlight">\(V_m\)</span> is the trans-membrane voltage, i.e. the voltage between intracellular and extracellular space,</p></li>
<li><p><span class="math notranslate nohighlight">\(A_m\)</span> is the fibers surface to volume ratio,</p></li>
<li><p><span class="math notranslate nohighlight">\(C_m\)</span> is the capacitance of the fiber membrane,</p></li>
<li><p><span class="math notranslate nohighlight">\(\sigma_\text{eff}\)</span> is the scalar effective conductivity of the system that can be computed from the intra and extracellular conductivities, <span class="math notranslate nohighlight">\(\sigma_\text{in}\)</span> and <span class="math notranslate nohighlight">\(\sigma_\text{ex}\)</span> as <span class="math notranslate nohighlight">\(\sigma_\text{eff} = \sigma_\text{in} \parallel \sigma_\text{ex} = (\sigma_\text{in} \cdot \sigma_\text{ex}) / (\sigma_\text{in} + \sigma_\text{ex})\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(I_\text{stim}\)</span> is an external stimulation current that models the external stimulation from the neuromuscular junction.</p></li>
<li><p><span class="math notranslate nohighlight">\(\textbf{y}\)</span> is a vector of additional states that are solved by a system of ODEs. The states correspond to ion channels in the membrane. Different formulations are possible for this ODE system.</p></li>
</ul>
<section id="hodgkin-huxley">
<h4>hodgkin_huxley<a class="headerlink" href="#hodgkin-huxley" title="Link to this heading"></a></h4>
<blockquote>
<div><p>This solves the Monodomain equation with the classical subcellular model of <a class="reference external" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1392413/">Hodgkin and Huxley (1952)</a>.</p>
<p>It is used to demonstrate several things about the Monodomain solver and nested solvers in general (because this is the easiest example, were a <cite>:doc:</cite>/settings/splitting` scheme is used).</p>
<p>Commands to compile and run this example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/monodomain/hodgkin_huxley
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
./hodgkin_huxley_strang<span class="w"> </span>../settings_hodgkin_huxley.py
</pre></div>
</div>
<p>The solver structure (file <code class="docutils literal notranslate"><span class="pre">solver_structure.txt</span></code>) is the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>The<span class="w"> </span>following<span class="w"> </span>data<span class="w"> </span>slot<span class="w"> </span>connection<span class="w"> </span>were<span class="w"> </span>given<span class="w"> </span>by<span class="w"> </span>the<span class="w"> </span>setting<span class="w"> </span><span class="s2">&quot;connectedSlots&quot;</span>:
<span class="w">       </span>h<span class="w"> </span>¤<span class="w"> </span>&lt;─&gt;<span class="w"> </span>¤<span class="w"> </span>h_gate

The<span class="w"> </span>following<span class="w"> </span>data<span class="w"> </span>slots<span class="w"> </span>were<span class="w"> </span>connected<span class="w"> </span>because<span class="w"> </span>the<span class="w"> </span>names<span class="w"> </span>appeared<span class="w"> </span><span class="k">in</span><span class="w"> </span>both<span class="w"> </span>terms<span class="w"> </span>of<span class="w"> </span>a<span class="w"> </span>coupling<span class="w"> </span>or<span class="w"> </span>splitting<span class="w"> </span>scheme:
<span class="w">  </span>m_gate<span class="w"> </span>¤<span class="w"> </span>&lt;─&gt;<span class="w"> </span>¤<span class="w"> </span>m_gate

Solver<span class="w"> </span>structure:

├──<span class="w"> </span>StrangSplitting
│<span class="w">  </span>data<span class="w"> </span>slots:
│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>solution.membrane/V<span class="w">                     </span>├───────────────<span class="w"> </span>¤0<span class="w"> </span>x
│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>solution.sodium_channel_m_gate/m<span class="w">        </span>:├────────m_gate<span class="w"> </span>¤1<span class="w"> </span>x
│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>solution.sodium_channel_h_gate/h<span class="w">        </span>::├───────h_gate<span class="w"> </span>¤2<span class="w"> </span>x
│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>solution.potassium_channel_n_gate/n<span class="w">     </span>:::├────────────<span class="w"> </span>¤3<span class="w"> </span>x
│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>additionalFieldVariable0<span class="w">                </span>::::├────────<span class="w"> </span>aa<span class="w"> </span>¤4<span class="w"> </span>x
│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>additionalFieldVariable1<span class="w">                </span>:::::├───────<span class="w"> </span>bb<span class="w"> </span>¤5<span class="w"> </span>x
│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>leakage_current/i_L<span class="w">                     </span>::::::├─────────<span class="w"> </span>¤6<span class="w"> </span>x
│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>solution<span class="w">                                </span>:::::::├─────<span class="w"> </span>vm<span class="w"> </span>¤7<span class="w"> </span>x
│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>additionalFieldVariable0<span class="w">                </span>::::::::├─m_gate<span class="w"> </span>¤8<span class="w"> </span>x
│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>additionalFieldVariable1<span class="w">                </span>:::::::::├────<span class="w"> </span>h<span class="w"> </span>¤9<span class="w"> </span>x
│<span class="w">                                              </span>::::::::::
│<span class="w">  </span>slot<span class="w"> </span>connections:<span class="w">                           </span>::::::::::
│<span class="w">  </span><span class="m">0</span>¤<span class="w"> </span>&lt;─&gt;<span class="w"> </span>¤0<span class="w">                                   </span>::::::::::
│<span class="w">  </span><span class="m">1</span>¤<span class="w"> </span>&lt;─&gt;<span class="w"> </span>¤1<span class="w">                                   </span>::::::::::
│<span class="w">  </span><span class="m">2</span>¤<span class="w"> </span>&lt;─&gt;<span class="w"> </span>¤2<span class="w">                                   </span>::::::::::
│<span class="w">                                              </span>::::::::::
│<span class="w"> </span>├──<span class="w"> </span>Heun<span class="w">                                     </span>::::::::::
│<span class="w"> </span>│<span class="w">  </span>data<span class="w"> </span>slots:<span class="w">                               </span>::::::::::
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>solution.membrane/V<span class="w">                   </span>├÷÷÷÷÷÷÷÷÷──────<span class="w"> </span>¤0&lt;─────┐
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>solution.sodium_channel_m_gate/m<span class="w">       </span>├÷÷÷÷÷÷÷÷m_gate<span class="w"> </span>¤1&lt;───┐<span class="w"> </span>│
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>solution.sodium_channel_h_gate/h<span class="w">        </span>├÷÷÷÷÷÷÷h_gate<span class="w"> </span>¤2&lt;─┐<span class="w"> </span>│<span class="w"> </span>│
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>solution.potassium_channel_n_gate/n<span class="w">      </span>├÷÷÷÷÷÷──────<span class="w"> </span>¤3<span class="w"> </span>x│<span class="w"> </span>│<span class="w"> </span>│
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>additionalFieldVariable0<span class="w">                  </span>├÷÷÷÷÷───<span class="w"> </span>aa<span class="w"> </span>¤4<span class="w"> </span>x│<span class="w"> </span>│<span class="w"> </span>│
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>additionalFieldVariable1<span class="w">                   </span>├÷÷÷÷───<span class="w"> </span>bb<span class="w"> </span>¤5<span class="w"> </span>x│<span class="w"> </span>│<span class="w"> </span>│
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>leakage_current/i_L<span class="w">                         </span>├÷÷÷──────<span class="w"> </span>¤6<span class="w"> </span>x│<span class="w"> </span>│<span class="w"> </span>│
│<span class="w"> </span>│<span class="w">                                                   </span>:::<span class="w">           </span>│<span class="w"> </span>│<span class="w"> </span>│
│<span class="w"> </span>│<span class="w"> </span>└──<span class="w"> </span>CellmlAdapter<span class="w">                                 </span>:::<span class="w">           </span>│<span class="w"> </span>│<span class="w"> </span>│
│<span class="w"> </span>└<span class="w">                                                   </span>:::<span class="w">           </span>│<span class="w"> </span>│<span class="w"> </span>│
│<span class="w">                                                     </span>:::<span class="w">           </span>│<span class="w"> </span>│<span class="w"> </span>│
│<span class="w"> </span>├──<span class="w"> </span>CrankNicolson<span class="w">                                   </span>:::<span class="w">           </span>│<span class="w"> </span>│<span class="w"> </span>│
│<span class="w"> </span>│<span class="w">  </span>data<span class="w"> </span>slots:<span class="w">                                      </span>:::<span class="w">           </span>│<span class="w"> </span>│<span class="w"> </span>│
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>solution<span class="w">                                     </span>├÷÷───<span class="w"> </span>vm<span class="w"> </span>¤0&lt;─┼─┼─┘
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>additionalFieldVariable0<span class="w">                      </span>├÷m_gate<span class="w"> </span>¤1&lt;─┼─┘
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>additionalFieldVariable1<span class="w">                       </span>├────<span class="w"> </span>h<span class="w"> </span>¤2&lt;─┘
│<span class="w"> </span>│
│<span class="w"> </span>│<span class="w"> </span>├──<span class="w"> </span>FiniteElementMethod
│<span class="w"> </span>│<span class="w"> </span>│<span class="w">  </span>data<span class="w"> </span>slots:
│<span class="w"> </span>│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>solution<span class="w">                                          </span>vm<span class="w"> </span>¤0<span class="w"> </span>x
│<span class="w"> </span>│<span class="w"> </span>│
│<span class="w"> </span>└
└

Connection<span class="w"> </span>Types:
<span class="w">  </span>+··+<span class="w">   </span>Internal<span class="w"> </span>connection,<span class="w"> </span>no<span class="w"> </span>copy
<span class="w">  </span>════<span class="w">   </span>Reuse<span class="w"> </span>variable,<span class="w"> </span>no<span class="w"> </span>copy
<span class="w">  </span>───&gt;<span class="w">   </span>Copy<span class="w"> </span>data<span class="w"> </span><span class="k">in</span><span class="w"> </span>direction<span class="w"> </span>of<span class="w"> </span>arrow
<span class="w">  </span>─m──<span class="w">   </span>Mapping<span class="w"> </span>between<span class="w"> </span>different<span class="w"> </span>meshes

Referenced<span class="w"> </span>Meshes:
<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span><span class="s2">&quot;MeshFiber&quot;</span>,<span class="w"> </span>1D<span class="w"> </span>regular<span class="w"> </span>fixed,<span class="w"> </span>linear<span class="w"> </span>Lagrange<span class="w"> </span>basis
</pre></div>
</div>
<p>For plotting the result, <cite>cd</cite> into the <code class="docutils literal notranslate"><span class="pre">out</span></code> directory as usual. Now you can see that two types of Python files have been created: some starting with <code class="docutils literal notranslate"><span class="pre">cellml_</span></code> and other starting with <code class="docutils literal notranslate"><span class="pre">vm_</span></code>. Only plot either of them, e.g. with <code class="docutils literal notranslate"><span class="pre">plot</span> <span class="pre">cellml_00000*</span></code> or <code class="docutils literal notranslate"><span class="pre">plot</span> <span class="pre">vm*</span></code>.</p>
<p>If you look into the settings, you’ll see that the <cite>cellml</cite> files were written by the <cite>CellmlAdapter</cite> and therefore contain all state variables. The <cite>vm</cite> files were created by the Timestepping scheme of the diffusion solver and, thus, contain only the solution variable of the diffusion solver, i.e., the transmembrane-voltage.
Because the option <code class="docutils literal notranslate"><span class="pre">&quot;nAdditionalFieldVariables&quot;</span></code> is set to <code class="docutils literal notranslate"><span class="pre">2</span></code>, also values of the two additional field variables will be written to the <cite>vm</cite> files. These field variables get values of the gating variables <cite>m</cite> and <cite>h</cite> of the membrane model. This is done by connecting their <a class="reference internal" href="../settings/output_connector_slots.html"><span class="doc">Connector Slots</span></a>, as can be seen in the solver structure visualization.</p>
<p>A reason for maybe not wanting to output the variables directly in the CellmlAdapter is that those files contain a lot of data and this will be time consuming for more advanced examples. Then, only writing the files with the variable of the diffusion is a good option.</p>
<p>Now the threre existing mechanisms to connect data slots are outlined.</p>
<ul>
<li><p>The first mechanism to connect slots is by naming the slots the same, then they are automatically connected and the data is transferred. This is done with the <cite>m</cite> variable in this example.</p></li>
<li><p>The second mechanism is to specify the connections in the global setting “connectedSlots”. This is done for the <cite>h</cite> gating variable, as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="o">...</span>
  <span class="s2">&quot;connectedSlots&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;h_gate&quot;</span><span class="p">),</span>      <span class="c1"># connect the additional field variable in the output writer</span>
    <span class="p">(</span><span class="s2">&quot;h_gate&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">),</span>
  <span class="p">],</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>Here, the two slots <code class="docutils literal notranslate"><span class="pre">h_gate</span></code> and <code class="docutils literal notranslate"><span class="pre">h</span></code> are connected, <code class="docutils literal notranslate"><span class="pre">h_gate</span></code> is the name of the slot at the <cite>CellmlAdapter</cite> and <code class="docutils literal notranslate"><span class="pre">h</span></code> is the slot name at the additional field variable, directly at the output writer.</p>
</li>
<li><p>There is a third mechanism to connect two slots: by specifying the connection in the splitting scheme under the options <code class="docutils literal notranslate"><span class="pre">&quot;connectedSlotsTerm1To2&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;connectedSlotsTerm2To1&quot;</span></code>. This is also done here for connecting the transmembrane voltage, <span class="math notranslate nohighlight">\(V_m\)</span>, between the <cite>CellmlAdapter</cite> and the diffusion solver.</p></li>
</ul>
<p>When running</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>plot<span class="w"> </span>cellml_00000*
</pre></div>
</div>
<p>in the <code class="docutils literal notranslate"><span class="pre">out</span></code> folder, you get the following animation:</p>
<figure class="align-default" id="id49">
<span id="hodgkin-huxley-1"></span><a class="reference internal image-reference" href="../_images/hodgkin_huxley_1.png"><img alt="../_images/hodgkin_huxley_1.png" src="../_images/hodgkin_huxley_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 43 </span><span class="caption-text">This shows the propagation of an action potential (here a snapshot at a given point in time, run the <cite>plot</cite> script to see the animation).</span><a class="headerlink" href="#id49" title="Link to this image"></a></p>
</figcaption>
</figure>
</div></blockquote>
</section>
<section id="hodgkin-huxley-fast">
<h4>hodgkin_huxley_fast<a class="headerlink" href="#hodgkin-huxley-fast" title="Link to this heading"></a></h4>
<blockquote>
<div><p>This example solves the same problem as the last one, but using the <a class="reference internal" href="../settings/fast_monodomain_solver.html"><span class="doc">FastMonodomainSolver</span></a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/monodomain/hodgkin_huxley
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
./fast_fiber<span class="w"> </span>../settings_fast_fiber.py<span class="w">       </span><span class="c1"># (1)</span>
./not_fast_fiber<span class="w"> </span>../settings_fast_fiber.py<span class="w">   </span><span class="c1"># (2)</span>
</pre></div>
</div>
<p>Command (1) uses the <a class="reference internal" href="../settings/fast_monodomain_solver.html"><span class="doc">FastMonodomainSolver</span></a> and takes 4 seconds. Command (2) does not use the FastMonodomainSolver and takes 17 seconds.</p>
<p>To check that both compute the same results there is a script <code class="docutils literal notranslate"><span class="pre">cmp.py</span></code> in the <cite>build_release/out</cite> directory. After compilation, run the following commands in the <cite>build_release</cite> directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm<span class="w"> </span>-rf<span class="w"> </span>out/fast<span class="w"> </span>out/not_fast
./not_fast_fiber<span class="w"> </span>../settings_fast_fiber.py<span class="w">   </span><span class="c1"># this outputs to directory `fast`</span>
mv<span class="w"> </span>out/fast<span class="w"> </span>out/not_fast<span class="w">                     </span><span class="c1"># rename output to `not_fast`</span>
./fast_fiber<span class="w"> </span>../settings_fast_fiber.py<span class="w">       </span><span class="c1"># this again outputs to `fast`</span>

<span class="c1"># now we have results from `fast_fibers` in directory `out/fast`</span>
<span class="c1"># and results from `not_fast_fibers` in directory `out/not_fast`</span>

<span class="nb">cd</span><span class="w"> </span>out
./cmp.py
</pre></div>
</div>
<p>This will output something like</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>...
file no. 0, error: 2.88667509952e-05
file no. 1, error: 1.94012102563e-05
...
file no. 199, error: 0.124314654799
avg error: 0.0941600520639
</pre></div>
</div>
<p>As can be seen the final average error is quite big. From the individual errors of the files we can see that the error gets bigger over time. This is the result of the stimuli  occuring to slightly different times, which leads to higher error values.</p>
<p>You can also plot the results in the <cite>out/fast</cite> and <cite>out/not_fast</cite> directories and see that they match qualitatively. Both results contain 10 stimuli.</p>
</div></blockquote>
</section>
<section id="motoneuron-hodgkin-huxley">
<h4>motoneuron_hodgkin_huxley<a class="headerlink" href="#motoneuron-hodgkin-huxley" title="Link to this heading"></a></h4>
<blockquote>
<div><p>This example uses a motoneuron model to schedule the stimuli, whereas in the previous examples, the stimulation times were given by the settings. Then, the Monodomain equation is computed with the Hodgkin-Huxley subcellular model. This example also demonstrates how to use the <a class="reference internal" href="../settings/map_dofs.html"><span class="doc">MapDofs</span></a> class in an approach without python callbacks.</p>
<figure class="align-default" id="model-schematic-motoneuron-hodgkin-huxley">
<a class="reference internal image-reference" href="../_images/model_schematic_motoneuron_hodgkin_huxley.svg"><img alt="../_images/model_schematic_motoneuron_hodgkin_huxley.svg" src="../_images/model_schematic_motoneuron_hodgkin_huxley.svg" width="100%" /></a>
</figure>
<p>This requires a prepared motor neuron model with input and output variables. The model used by this example is a modified Hodgkin-Huxley CellML model (<code class="docutils literal notranslate"><span class="pre">motoneuron_hodgkin_huxley.cellml</span></code>). This means there are two Hodgkin-Huxley models, one for the motor neuron and one for the Monodomain equation.</p>
<p>If an existing motor neuron CellML model should be used without modification, e.g. the normal Hodgkin-Huxley model, then a different approach with python callbacks would be needed.</p>
<p>How it works can be explained with an part from the <code class="docutils literal notranslate"><span class="pre">solver_structure.txt</span></code> file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>│<span class="w"> </span>├──<span class="w"> </span>Heun<span class="w">                                     </span>::::::
│<span class="w"> </span>│<span class="w">  </span>data<span class="w"> </span>slots:<span class="w">                               </span>::::::
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>firing_threshold/V_extern_out<span class="w">         </span>├÷÷÷÷÷<span class="w"> </span>v_out<span class="w"> </span>¤0&lt;───┐
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span><span class="o">(</span>P<span class="o">)</span>firing_threshold/V_extern_in<span class="w">        </span>├÷÷÷÷─<span class="w"> </span>v_in<span class="w"> </span>¤1&lt;─┐<span class="w"> </span>│
│<span class="w"> </span>│<span class="w">                                              </span>::::<span class="w">           </span>│<span class="w"> </span>│
│<span class="w"> </span>│<span class="w"> </span>└──<span class="w"> </span>CellmlAdapter<span class="w">                            </span>::::<span class="w">           </span>│<span class="w"> </span>│
│<span class="w"> </span>└<span class="w">                                              </span>::::<span class="w">           </span>│<span class="w"> </span>│
│<span class="w">                                                </span>::::<span class="w">           </span>│<span class="w"> </span>│
│<span class="w"> </span>├──<span class="w"> </span>MapDofs<span class="w">                                    </span>::::<span class="w">           </span>│<span class="w"> </span>│
│<span class="w"> </span>│<span class="w">  </span>data<span class="w"> </span>slots:<span class="w">                                 </span>::::<span class="w">           </span>│<span class="w"> </span>│
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>b<span class="o">]</span><span class="w"> </span>solution.membrane/V<span class="w">              </span>┌»┌<span class="w">    </span>├÷÷÷───<span class="w"> </span>vm<span class="w"> </span>¤0<span class="w"> </span>x│<span class="w"> </span>│
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>b<span class="o">]</span><span class="w"> </span>solution<span class="w">                         </span>│<span class="w"> </span>│<span class="w">    </span>:├÷÷───<span class="w"> </span>vm<span class="w"> </span>¤1<span class="w"> </span>x│<span class="w"> </span>│
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>additionalFieldVariable0<span class="w">         </span>└<span class="w"> </span>│<span class="w">    </span>::├÷<span class="w"> </span>v_out<span class="w"> </span>¤2&lt;─┼─┘
│<span class="w"> </span>│<span class="w">  </span><span class="o">[</span>a<span class="o">]</span><span class="w"> </span>additionalFieldVariable1<span class="w">           </span>└»<span class="w">   </span>::<span class="w"> </span>├─<span class="w"> </span>v_in<span class="w"> </span>¤3&lt;─┘
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">vm</span></code> is the field variable for the transmembrane voltage, <span class="math notranslate nohighlight">\(V_m\)</span>, that is used in the Monodomain equation. At a given time, the first <cite>MapDofs</cite> call copies the values of <cite>vm</cite> from the center point of the fiber to the <cite>v_in</cite> slot, which is an input to the motor neuron model. If the motor neuron does not fire, it sets the output value <cite>v_out</cite> equal to the input value <cite>v_in</cite>. The CellML motor neuron model is also advanced in time and eventually depolarizes and “fires”. Then the <cite>v_out</cite> variable gets to value of 20. Then, the second <cite>MapDofs</cite> action copies the value of <cite>v_out</cite> back to <cite>vm</cite> at the 3 center nodes of the fiber. The new prescribed value leads to a stimulation at the center of the fiber.</p>
<p>The modifications needed in the CellML model are the threshold condition, that sets the output value <cite>v_out</cite>. The additional code in the CellML model of the motoneuron is as follows:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">def</span><span class="w"> </span><span class="n">comp</span><span class="w"> </span><span class="n">firing_threshold</span><span class="w"> </span><span class="n">as</span>
<span class="w">    </span><span class="n">var</span><span class="p">{</span><span class="n">membrane_V</span><span class="p">}</span><span class="w"> </span><span class="n">V</span><span class="o">:</span><span class="w"> </span><span class="n">millivolt</span><span class="w"> </span><span class="p">{</span><span class="n">pub</span><span class="o">:</span><span class="w"> </span><span class="n">in</span><span class="p">};</span>
<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="n">V_extern_in</span><span class="o">:</span><span class="w"> </span><span class="n">dimensionless</span><span class="w"> </span><span class="p">{</span><span class="n">init</span><span class="o">:</span><span class="w"> </span><span class="mi">-75</span><span class="p">};</span>

<span class="w">    </span><span class="c1">// input membrane voltage, from fibre sub-cellular model</span>
<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="n">V_extern_out</span><span class="o">:</span><span class="w"> </span><span class="n">dimensionless</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// output membrane voltage, to fibre sub-cellular model</span>
<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="n">V_threshold</span><span class="o">:</span><span class="w"> </span><span class="n">millivolt</span><span class="w"> </span><span class="p">{</span><span class="n">init</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">};</span>

<span class="w">    </span><span class="c1">// threshold of V, when it is considered active</span>
<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="n">V_firing</span><span class="o">:</span><span class="w"> </span><span class="n">dimensionless</span><span class="w"> </span><span class="p">{</span><span class="n">init</span><span class="o">:</span><span class="w"> </span><span class="mi">20</span><span class="p">};</span>

<span class="w">    </span><span class="c1">// constant value to which V_extern_out will be set when motoneuron fires</span>
<span class="w">    </span><span class="n">V_extern_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sel</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">V</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="no">V_threshold</span><span class="p">:</span>
<span class="w">            </span><span class="n">V_firing</span><span class="p">;</span>
<span class="w">        </span><span class="nl">otherwise</span><span class="p">:</span>
<span class="w">            </span><span class="n">V_extern_in</span><span class="p">;</span>
<span class="w">    </span><span class="n">endsel</span><span class="p">;</span>
<span class="n">enddef</span><span class="p">;</span>
</pre></div>
</div>
<p>Use the following commands to compile and run the example.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/monodomain/motoneuron_hodgkin_huxley
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
./motoneuron_hodgkin_huxley<span class="w"> </span>../settings_motoneuron_hodgkin_huxley.py
</pre></div>
</div>
<figure class="align-default" id="id50">
<span id="motoneuron-hodgkin-huxley-1"></span><a class="reference internal image-reference" href="../_images/motoneuron_hodgkin_huxley_1.png"><img alt="../_images/motoneuron_hodgkin_huxley_1.png" src="../_images/motoneuron_hodgkin_huxley_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 44 </span><span class="caption-text">This shows the evaluation of the motoneuron over time.</span><a class="headerlink" href="#id50" title="Link to this image"></a></p>
</figcaption>
</figure>
</div></blockquote>
</section>
<section id="other-subcellular-models">
<h4>Other subcellular models<a class="headerlink" href="#other-subcellular-models" title="Link to this heading"></a></h4>
<p>The following subcellular models are also implemented. The examples are very similar to the hodgkin-huxley example except for the different CellML model file.
All of these examples run also in parallel and can be started by prepending, e.g., <code class="docutils literal notranslate"><span class="pre">mpirun</span> <span class="pre">-n</span> <span class="pre">4</span></code>.</p>
<ul>
<li><p><strong>motoneuron_cisi_kohn</strong></p>
<p>This is again the normal  Monodomain with subcellular model of Hodgkin-Huxley, but it uses the motor neuron model of <a class="reference external" href="https://pubmed.ncbi.nlm.nih.gov/18506610/">Cisi and Kohn</a>. This is an approach with a python callback function that does not need any modification of the CellML model in use. The callback function demonstrates how to delay a signal.</p>
<figure class="align-default" id="id51">
<span id="motoneuron-cisi-kohn-1"></span><a class="reference internal image-reference" href="../_images/motoneuron_cisi_kohn_1.png"><img alt="../_images/motoneuron_cisi_kohn_1.png" src="../_images/motoneuron_cisi_kohn_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 45 </span><span class="caption-text">This shows the evaluation of the motoneuron over time.</span><a class="headerlink" href="#id51" title="Link to this image"></a></p>
</figcaption>
</figure>
</li>
<li><p><strong>hodgkin_huxley-razumova</strong></p>
<p>This is a CellML model that computes activation and active stress values with only 9 states and 19 algebraics. The example also directly outputs png files, so no additional plot command is required.</p>
</li>
<li><p><strong>shorten_ocallaghan_davidson_soboleva_2007</strong></p>
<p>This is the Shorten model, see the description <a class="reference external" href="https://models.physiomeproject.org/exposure/159ba2f081022ca651284404f39eeb40/shorten_ocallaghan_davidson_soboleva_2007_variant01.cellml/view">here</a>.</p>
</li>
<li><p><strong>new_slow_TK_2014_12_08</strong></p>
<p>This is the model that was used in OpenCMISS, it is a variant of the Shorten model.</p>
</li>
<li><p><strong>hodgkin-huxley_shorten_ocallaghan_davidson_soboleva_2007</strong></p>
<p>This is a combination of the membrane model of Hodgkin-Huxley and the rest from Shorten, to make it faster (not completely sure).</p>
</li>
</ul>
</section>
</section>
<section id="fibers">
<h3>Fibers<a class="headerlink" href="#fibers" title="Link to this heading"></a></h3>
<p>The following examples all include fibers, where the Monodomain Equation is solved.
This can be done by either building the splitting scheme from nested solvers (e.g. as in <cite>multiple_fibers</cite>, <cite>multiple_fibers_cubes_partitioning</cite>, <cite>fibers_emg</cite>, <cite>cuboid</cite>) or by using the faster FastMonodomainSolver (e.g. in <cite>fibers_emg</cite>, <cite>fibers_fat_emg</cite>, <cite>fibers_contraction</cite>).</p>
<section id="multiple-fibers">
<h4>multiple_fibers<a class="headerlink" href="#multiple-fibers" title="Link to this heading"></a></h4>
<p>Multiple instances of the Monodomain equation, i.e. multiple biceps fibers with electrophysiology. The fibers are not subdivided to several subdomains.
When using multiple processes, every process simulates whole fibers. The example has an easy settings file that contains all configuration in a single file.</p>
<figure class="align-default" id="id52">
<span id="model-schematic-multiple-fibers"></span><a class="reference internal image-reference" href="../_images/model_schematic_multiple_fibers.svg"><img alt="../_images/model_schematic_multiple_fibers.svg" src="../_images/model_schematic_multiple_fibers.svg" width="100%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 46 </span><span class="caption-text">Models that are used in the <cite>multiple_fibers</cite> example.</span><a class="headerlink" href="#id52" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>This example has MegaMol integration but also outputs Paraview files. If run without MegaMol enabled in opendihu, it will display an error, but work normally.</p>
<p>The number of fibers depends on the number of processes.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># arguments:  [&lt;n_processes_per_fiber&gt; [&lt;scenario_name&gt;]]</span>
</pre></div>
</div>
<p>E.g. to have 2 fibers with 2 processes, each:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./multiple_fibers<span class="w"> </span>../settings_multiple_fibers.py<span class="w"> </span><span class="m">2</span>
</pre></div>
</div>
<p>A lot of other options can be set, to get a list, run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./multiple_fibers<span class="w"> </span>../settings_multiple_fibers.py<span class="w"> </span>--help
</pre></div>
</div>
<p>It is not possible with this example to have cube-shaped partitions because of the solver structure.
In order to have a process compute multiple fibers but only a part of them, use the <cite>multiple_fibers_cubes_partitioning</cite> example.
Compare  <cite>multiple_fibers_cubes_partitioning/src/multiple_fibers.cpp</cite>  with <cite>multiple_fibers/src/multiple_fibers.cpp</cite> to get the difference.</p>
</section>
<section id="multiple-fibers-cubes-partitioning">
<h4>multiple_fibers_cubes_partitioning<a class="headerlink" href="#multiple-fibers-cubes-partitioning" title="Link to this heading"></a></h4>
<p>Again multiple fibers but this time they can be subdivided such that every process can compute a “cubic” subdomain that contains parts of several fibers.
The model is the same as in <a class="reference internal" href="#model-schematic-multiple-fibers"><span class="std std-numref">Fig. 46</span></a>.</p>
<p>Multiple 1D fibers (monodomain), biceps geometry
This is similar to the <cite>fibers_emg</cite> example, but without EMG.</p>
<p>To see all available arguments, execute:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./multiple_fibers<span class="w"> </span>settings_multiple_fibers_cubes_partitioning.py<span class="w"> </span>-help
</pre></div>
</div>
<p>if <code class="docutils literal notranslate"><span class="pre">fiber_file=cuboid.bin</span></code>, it uses a small cuboid test example (Contrary to the “cuboid” example, this produces a real cuboid).</p>
<p>You can do the domain decomposition yourself or let the program decide it.
Doing in manually means setting the option <code class="docutils literal notranslate"><span class="pre">n_subdomains</span></code>. The given number of subdomains has to match the number of processes, e.g. 2x2x1 = 4 processes.
The domain decomposition can be specified in x,y and z direction, where the fibers are aligned with the z axis.</p>
<p>Examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--n_subdomains</span> <span class="pre">2</span> <span class="pre">2</span> <span class="pre">1</span></code>, <span class="math notranslate nohighlight">\(2\times 2\times 1\)</span>, this means no subdivision per fiber,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--n_subdomains</span> <span class="pre">8</span> <span class="pre">8</span> <span class="pre">4</span></code>, every fiber will be subdivided to 4 processes and all fibers will be computed by 8x8 processes.</p></li>
</ul>
<p>Example with 4 processes and end time 5, and otherwise default parameters:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./shorten_cn<span class="w"> </span>../settings_multiple_fibers_cubes_partitioning.py<span class="w"> </span>shorten.py<span class="w"> </span>--n_subdomains<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>--end_time<span class="o">=</span><span class="m">5</span>.0
</pre></div>
</div>
<p>Three files contribute to the settings:
A lot of variables are set by the helper.py script, the variables and their values are defined in variables.py and this file
creates the composite config that is needed by opendihu.
You can provide parameter values in a shorten.py file in the variables subfolder. (Instead of shorten.py you can choose any filename.)
This custom variables file should be the next argument on the command line after settings_fibers_emg.py, e.g.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>./shorten_cn<span class="w"> </span>../settings_multiple_fibers_cubes_partitioning.py<span class="w"> </span>shorten.py<span class="w"> </span>--n_subdomains<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>--end_time<span class="o">=</span><span class="m">5</span>.0
</pre></div>
</div>
<p>E.g. try</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./shorten_cn<span class="w"> </span>../settings_multiple_fibers_cubes_partitioning.py<span class="w"> </span>shorten.py<span class="w"> </span>--n_subdomains<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w">      </span><span class="c1"># (1)</span>
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./shorten_fast_cn<span class="w"> </span>../settings_multiple_fibers_cubes_partitioning.py<span class="w"> </span>shorten.py<span class="w">            </span><span class="c1"># (2)</span>
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./hh_cn<span class="w"> </span>../settings_multiple_fibers_cubes_partitioning.py<span class="w"> </span>hodgkin_huxley.py<span class="w">               </span><span class="c1"># (3)</span>
</pre></div>
</div>
<p>Note that scenarios (2) and (3) use the automatic partitioning feature. The resulting domain decomposition will be <span class="math notranslate nohighlight">\(2 \times 1 \times 2\)</span>.</p>
<p>Scenario (1) and (2) use the shorten subcellular model. Scenario (3) uses the Hodgkin-Huxley subcellular model.</p>
<p>Scenarios (1) and (3) use the normal operator splitting with Heun and Crank-Nicolson. Scenario (2) uses the FastMonodomainSolver.</p>
</section>
<section id="fibers-emg">
<h4>fibers_emg<a class="headerlink" href="#fibers-emg" title="Link to this heading"></a></h4>
<p>This is the <em>main</em> example for multiple fibers without fat layer. Again multiple fibers can be subdivided, furthermore everything is coupled to a static bidomain equation. This example was used for large-scale tests on Hazel Hen (supercomputer in Stuttgart until 2019) and was successfully executed for 270.000 fibers on 27.000 cores.  (Same as <a class="reference internal" href="#model-schematic-multiple-fibers"><span class="std std-numref">Fig. 46</span></a>)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/fibers_emg
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release

mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>./fast_fibers_emg<span class="w"> </span>../settings_fibers_emg.py<span class="w"> </span>ramp_emg.py<span class="w">   </span><span class="c1"># (1)</span>
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>./fibers_emg<span class="w"> </span>../settings_fibers_emg.py<span class="w"> </span>ramp_emg.py<span class="w">        </span><span class="c1"># (2)</span>
</pre></div>
</div>
<p>Both scenarios, (1) and (2), compute the same, but (2) uses the <a class="reference internal" href="../settings/fast_monodomain_solver.html"><span class="doc">FastMonodomainSolver</span></a> and, thus, is by a factor of ~10 faster.
Any number of processes can be used, the partitioning is done automatically such that all processes are used and cube-shaped partitions are generated. Thus, it makes sense to provide a number of processes that has a lot of divisors, like 60.</p>
<p>The settings for this example consists of two files that are the two parameters to the command: the main file is <code class="docutils literal notranslate"><span class="pre">settings_fibers_emg.py</span></code> where all settings for
the solvers are specified.
Some of the values there have variables that are set in the second file. The second settings file in this example is <code class="docutils literal notranslate"><span class="pre">ramp_emg.py</span></code>.
The file is stored in the <code class="docutils literal notranslate"><span class="pre">variables</span></code> subdirectory.
It is more compact and contains only the values that need to be specified for a particular scenario.</p>
<p>If a simulation with a different set of parameters is needed, the best way is to create a copy of the scenario file in the variables directory and adjust it.
Then call the simulation with this filename as the second argument.</p>
<p>Additionally, there is a number of parameters that can be overwritten on the command line, for details see</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./fast_fibers_emg<span class="w"> </span>../settings_fibers_emg.py<span class="w"> </span>ramp_emg.py<span class="w"> </span>--help
</pre></div>
</div>
<p>An example is to set the end time to 5 ms and a particular partitioning of <span class="math notranslate nohighlight">\(1 \times 2 \times 4\)</span> (instead of the default <span class="math notranslate nohighlight">\(2 \times 2 \times 2\)</span>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span><span class="w"> </span>./fast_fibers_emg<span class="w"> </span>../settings_fibers_emg.py<span class="w"> </span>ramp_emg.py<span class="w"> </span>--end_time<span class="o">=</span><span class="m">5</span><span class="w"> </span>--n_subdomains<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">4</span>
</pre></div>
</div>
<figure class="align-default" id="id53">
<span id="fibers-emg-1"></span><a class="reference internal image-reference" href="../_images/fibers_emg_1.png"><img alt="../_images/fibers_emg_1.png" src="../_images/fibers_emg_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 47 </span><span class="caption-text">Top: fibers, bottom: intramuscular EMG, <span class="math notranslate nohighlight">\(\phi_e\)</span></span><a class="headerlink" href="#id53" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id54">
<span id="fibers-emg-2"></span><a class="reference internal image-reference" href="../_images/fibers_emg_2.png"><img alt="../_images/fibers_emg_2.png" src="../_images/fibers_emg_2.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 48 </span><span class="caption-text">Inside the muscle with <span class="math notranslate nohighlight">\(37^2=1369\)</span> fibers</span><a class="headerlink" href="#id54" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id55">
<span id="fibers-emg-3"></span><a class="reference internal image-reference" href="../_images/fibers_emg_3.png"><img alt="../_images/fibers_emg_3.png" src="../_images/fibers_emg_3.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 49 </span><span class="caption-text">Domain decomposition to 60 processes</span><a class="headerlink" href="#id55" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="cuboid">
<h4>cuboid<a class="headerlink" href="#cuboid" title="Link to this heading"></a></h4>
<p>Whereas all previous examples use biceps brachii geometry, this example is simply a cuboid
and does not need any geometry information at all. Only here, the number of nodes per fiber can be adjusted.</p>
<p>This example has a fixed number of fibers that are not at a specified geometry. (In fact, they are all on top of each other.)
The settings file is very short and contains all needed information. This is much simpler than the other electrophysiology examples.</p>
<p>The purpose of this example is to test numerical parameters or do performance measurements where a specific number of fibers and processes is needed.</p>
<p>The Monodomain equation is solved with the shorten subcellular model. (The same as in <a class="reference internal" href="#model-schematic-multiple-fibers"><span class="std std-numref">Fig. 46</span></a>)</p>
<p>Compile as follows,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/cuboid
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>You have to pass additional arguments to the program:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># arguments: &lt;n_processes_per_fiber&gt; &lt;n_fibers&gt; &lt;n_nodes_per_fiber&gt; &lt;scenario_name&gt;</span>

<span class="c1"># scenario with 2 fibers with 100 nodes each (1):</span>
./cuboid<span class="w"> </span>../settings_cuboid.py<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">100</span><span class="w"> </span>test_run

<span class="c1"># 2 fibers with 2 processes each, i.e. 4 processes in total (2):</span>
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./cuboid<span class="w"> </span>../settings_cuboid.py<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">100</span><span class="w"> </span>parallel

<span class="c1"># 4 fibers with 2 processes each, i.e. 8 processes in total (3):</span>
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span><span class="w"> </span>./cuboid<span class="w"> </span>../settings_cuboid.py<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p>The number of processes per fiber times the number of fibers has to be equal to the given number of processes in mpirun.</p>
<figure class="align-default" id="id56">
<span id="cuboid-1"></span><a class="reference internal image-reference" href="../_images/cuboid_1.png"><img alt="../_images/cuboid_1.png" src="../_images/cuboid_1.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 50 </span><span class="caption-text">This shows how the fibers are aligned spatially (for scenario (2)), click to enlarge.</span><a class="headerlink" href="#id56" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="fibers-fat-emg">
<h4>fibers_fat_emg<a class="headerlink" href="#fibers-fat-emg" title="Link to this heading"></a></h4>
<p>This example adds a fat and skin layer to simulate EMG signals on the skin surface. It is also configured to sample signals at a simulated high-density EMG electrode array on the skin surface.
The data is written to a VTK and a csv file.</p>
<figure class="align-default" id="id57">
<span id="model-schematic-fibers-emg"></span><a class="reference internal image-reference" href="../_images/model_schematic_fibers_emg.svg"><img alt="../_images/model_schematic_fibers_emg.svg" src="../_images/model_schematic_fibers_emg.svg" width="100%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 51 </span><span class="caption-text">Models that are used in the <cite>fibers_fat_emg</cite> example.</span><a class="headerlink" href="#id57" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The example can be compiled and run by the following commands. Instead of 2 processes, more are possible and often beneficial, depending on the used computer. This examples has very good parallel scaling.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/fibers_fat_emg
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release

mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>./fibers_fat_emg<span class="w"> </span>../settings_fibers_fat_emg.py<span class="w"> </span>biceps.py
</pre></div>
</div>
<p>Similar to <cite>fibers_emg</cite>, The settings for this example consists of two files that are the two parameters to the command: the main file is <code class="docutils literal notranslate"><span class="pre">settings_fibers_fat_emg.py</span></code> where all settings for the solvers are specified.
Some of the values there have variables that are set in the second file. The second settings file in this example is <code class="docutils literal notranslate"><span class="pre">biceps.py</span></code>. The file is stored in the <code class="docutils literal notranslate"><span class="pre">variables</span></code> subdirectory.
It is more compact and contains only the values that need to be specified for a particular scenario.</p>
<p>If a simulation with a different set of parameters is needed, the best way is to create a copy of the scenario file in the variables directory and set adjust it. Then call the simulation with this filename as the second argument.</p>
<p>Additionally, there is a number of parameters that can be overwritten on the command line, for details see</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./fibers_fat_emg<span class="w"> </span>../settings_fibers_fat_emg.py<span class="w"> </span>biceps.py<span class="w"> </span>--help
</pre></div>
</div>
<p>An example is to set the end time to 5:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>./fibers_fat_emg<span class="w"> </span>../settings_fibers_fat_emg.py<span class="w"> </span>biceps.py<span class="w"> </span>--end_time<span class="o">=</span><span class="m">5</span>
</pre></div>
</div>
<p>The results are written to several files in the <code class="docutils literal notranslate"><span class="pre">out/&lt;scenario&gt;</span></code> directory, e.g. <code class="docutils literal notranslate"><span class="pre">out/biceps</span></code>.
There are different files containing fibers, the muscle and fat volume, only the surface and the electrodes. The intervals in which these files are written can be adjusted in the scenario file.
The fibers and volume files have a large size, whereas the surface and electrode files have small sizes. When running simulations with long time spans or high resolution, output storage can be a problem.
Then, it makes sense to only output surface and electrode data, as this is usually the interesting data.</p>
<figure class="align-default" id="id58">
<span id="fibers-fat-emg1"></span><a class="reference internal image-reference" href="../_images/fibers_fat_emg1.png"><img alt="../_images/fibers_fat_emg1.png" src="../_images/fibers_fat_emg1.png" style="width: 40%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 52 </span><span class="caption-text">Top: Fibers and surface, bottom: volume of muscle and fat.</span><a class="headerlink" href="#id58" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id59">
<span id="fibers-fat-emg2"></span><a class="reference internal image-reference" href="../_images/fibers_fat_emg2.png"><img alt="../_images/fibers_fat_emg2.png" src="../_images/fibers_fat_emg2.png" style="width: 40%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 53 </span><span class="caption-text">Electrodes with EMG values. The values are the same as in the surface.</span><a class="headerlink" href="#id59" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id60">
<span id="fibers-fat-emg3"></span><a class="reference internal image-reference" href="../_images/fibers_fat_emg3.png"><img alt="../_images/fibers_fat_emg3.png" src="../_images/fibers_fat_emg3.png" style="width: 40%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 54 </span><span class="caption-text">Surface electrodes with the process number for the example of two processes. It can be seen how the domain is split to rank 0 and 1. The EMG values are only computed on their respective rank.
For the surface output files, each rank writes their own data, i.e. there is no communication of data between the ranks for the output (which is efficient). For the electrode values, all values are send to rank 0 which writes the data to a file.
This is still acceptible because the number of electrodes is usually small compared to the resolution of the 2D and 3D meshes.</span><a class="headerlink" href="#id60" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Initially, each process tries to find as many of the electrode points as possible on its own subdomain. Which points are found by which rank can be seen by the <code class="docutils literal notranslate"><span class="pre">electrodes_found*</span></code> and <code class="docutils literal notranslate"><span class="pre">electrodes_not_found</span></code> files.
Some points will be found by multiple processes. Then only the values on the rank that actually own the subdomains are used.</p>
<p>The electrode data is always written in two formats. First, for ParaView (*.vtp), second as CSV file.
The csv files are for easier processing with other tools or python scripts. The csv file is called <cite>electrodes.csv</cite>.</p>
<p>There is one script that visualizes all EMG measurements over time. It is located in the top level directory of the exercise.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/fibers_fat_emg
./plot_emg.py<span class="w">                                           </span><span class="c1"># use the default file</span>
./plot_emg.py<span class="w"> </span>build_release/out/biceps/electrodes.csv<span class="w">   </span><span class="c1"># specify the file manually</span>
</pre></div>
</div>
<figure class="align-default" id="fibers-fat-emg4">
<a class="reference internal image-reference" href="../_images/fibers_fat_emg4.png"><img alt="../_images/fibers_fat_emg4.png" src="../_images/fibers_fat_emg4.png" style="width: 60%;" /></a>
</figure>
</section>
<section id="analytical-fibers-emg">
<h4>analytical_fibers_emg<a class="headerlink" href="#analytical-fibers-emg" title="Link to this heading"></a></h4>
<p>This example uses an analytical description of action potential propagation, which replaces the Monodomain Equation on the fibers. Multiple fibers are coupled with Bidomain equation.
Thus, this example is the same as <cite>fibers_emg</cite>, except that Monodomain eq. is replaced by an analytic equation.</p>
<p>The analytic model is the one of <a class="reference external" href="https://pubmed.ncbi.nlm.nih.gov/5383732/">Rosenfalck 1969</a>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}G(z) = \begin{cases}
  96\,z^3\,exp(-z) - 90 &amp; \text{ for } z \geq 0 \\
  -90 &amp; \text{ for } z &lt; 0
\end{cases}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(z=U\cdot t\)</span> with propagation velocity <span class="math notranslate nohighlight">\(U\)</span>, see <a class="reference internal" href="#analytical-fibers-emg-3"><span class="std std-numref">Fig. 55</span></a>.</p>
<figure class="align-default" id="id61">
<span id="analytical-fibers-emg-3"></span><a class="reference internal image-reference" href="../_images/analytical_fibers_emg_3.png"><img alt="../_images/analytical_fibers_emg_3.png" src="../_images/analytical_fibers_emg_3.png" style="width: 40%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 55 </span><span class="caption-text">Rosenfalck function <span class="math notranslate nohighlight">\(g(z)\)</span>. Note the the shapes of the propagating stimuli correspond to this graph, propagating to the left (negative z axis).</span><a class="headerlink" href="#id61" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/analytical_fibers_emg
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release

mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>./analytical_fibers_emg<span class="w"> </span>../settings_analytical_fibers_emg.py<span class="w"> </span>biceps.py<span class="w">              </span><span class="c1"># (1)</span>
./analytical_fibers_emg<span class="w"> </span>../settings_analytical_fibers_emg_custom_geometry.py<span class="w"> </span>geometry_square.py<span class="w"> </span><span class="c1"># (2)</span>
./analytical_fibers_emg<span class="w"> </span>../settings_analytical_fibers_emg_custom_geometry.py<span class="w"> </span>geometry_round.py<span class="w">  </span><span class="c1"># (3)</span>
</pre></div>
</div>
<p>Szenario (1) uses the biceps geometry and fiber files. It can be run in parallel.</p>
<p>Scenarios (2) and (3) use a custom geometry that is defined in the python settings. The fibers are independent of the muscle geometry and can be parametrized with different angles. These scenarios only run in serial.</p>
<figure class="align-default" id="id62">
<span id="analytical-fibers-emg-0"></span><a class="reference internal image-reference" href="../_images/analytical_fibers_emg_0.png"><img alt="../_images/analytical_fibers_emg_0.png" src="../_images/analytical_fibers_emg_0.png" style="width: 40%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 56 </span><span class="caption-text">Results of scenario (1)</span><a class="headerlink" href="#id62" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id63">
<span id="analytical-fibers-emg-2"></span><a class="reference internal image-reference" href="../_images/analytical_fibers_emg_2.png"><img alt="../_images/analytical_fibers_emg_2.png" src="../_images/analytical_fibers_emg_2.png" style="width: 40%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 57 </span><span class="caption-text">Results of scenario (2). The geometry has a square cross-section of the muscle. The “radius” along the muscle follows a sine curve.</span><a class="headerlink" href="#id63" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id64">
<span id="analytical-fibers-emg-1"></span><a class="reference internal image-reference" href="../_images/analytical_fibers_emg_1.png"><img alt="../_images/analytical_fibers_emg_1.png" src="../_images/analytical_fibers_emg_1.png" style="width: 40%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 58 </span><span class="caption-text">Results of scenario (3). The geometry has a circular cross-section of the muscle. The radius along the muscle follows a sine curve. Top: geometry, bottom: fibers with angles <span class="math notranslate nohighlight">\(\alpha=0.4\pi\)</span> and <span class="math notranslate nohighlight">\(\beta=0.2\pi\)</span>.</span><a class="headerlink" href="#id64" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="load-balancing">
<h4>load_balancing<a class="headerlink" href="#load-balancing" title="Link to this heading"></a></h4>
<p>Electrophysiology of a small number of fibers where computational load balancing and time adaptive stepping schemes are considered.
It was developed as part of a Bachelor thesis.  (Same model as in <a class="reference internal" href="#model-schematic-multiple-fibers"><span class="std std-numref">Fig. 46</span></a>)</p>
<p>Compile as follows, it still works!</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/load_balancing
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<p>There are two scenarios with adaptive timestepping, (1) and (2). They use the adaptive Heun timestepping solver, <cite>HeunAdaptive</cite> and use a different variant of the algorithm.
The third scenario, (3), simply uses the FastMonodomainSolver to simulate the same without adaptive timestepping.</p>
<p>The program has to be run with 4 processes and simulates two fibers with 2 processes each.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./load_balancing<span class="w"> </span>../settings_load_balancing.py<span class="w"> </span>regular<span class="w">    </span><span class="c1"># (1)</span>
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./load_balancing<span class="w"> </span>../settings_load_balancing.py<span class="w"> </span>modified<span class="w">   </span><span class="c1"># (2)</span>
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./fast_fibers<span class="w"> </span>../settings_fast_fibers.py<span class="w">                  </span><span class="c1"># (3)</span>
</pre></div>
</div>
<p>The timestep width can be plotted by using the plot_timestep_widths.py script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/load_balancing
./plt_timestep_widths.py
</pre></div>
</div>
<figure class="align-default" id="id65">
<span id="load-balancing-2"></span><a class="reference internal image-reference" href="../_images/load_balancing_2.png"><img alt="../_images/load_balancing_2.png" src="../_images/load_balancing_2.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 59 </span><span class="caption-text">The two fibers that are simulated in scenarios (1) and (2) at t=20.</span><a class="headerlink" href="#id65" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id66">
<span id="load-balancing-3"></span><a class="reference internal image-reference" href="../_images/load_balancing_3.png"><img alt="../_images/load_balancing_3.png" src="../_images/load_balancing_3.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 60 </span><span class="caption-text">The two fibers that are simulated in scenarios (1) and (2) at t=15.</span><a class="headerlink" href="#id66" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id67">
<span id="load-balancing-1"></span><a class="reference internal image-reference" href="../_images/load_balancing_1.png"><img alt="../_images/load_balancing_1.png" src="../_images/load_balancing_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 61 </span><span class="caption-text">Timestep widths during the simulation of scenario (1) on all ranks. It can be seen that the timestep width jumpes between values.
If a timestep width was fine, it is increased until it is too high, then it is reduced again. At <span class="math notranslate nohighlight">\(t \approx 15\)</span>, two new action potentials start at the center, as can be seen in <a class="reference internal" href="#load-balancing-3"><span class="std std-numref">Fig. 60</span></a>.</span><a class="headerlink" href="#id67" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id68">
<span id="load-balancing-4"></span><a class="reference internal image-reference" href="../_images/load_balancing_4.png"><img alt="../_images/load_balancing_4.png" src="../_images/load_balancing_4.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 62 </span><span class="caption-text">Timestep widths during the simulation of scenario (2) with the modified adaptive Heun algorithm.</span><a class="headerlink" href="#id68" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The results of two different strategies for adapting the time step width can be seen in <a class="reference internal" href="#load-balancing-1"><span class="std std-numref">Fig. 61</span></a> and <a class="reference internal" href="#load-balancing-4"><span class="std std-numref">Fig. 62</span></a>.
The total runtimes of 20ms of simulation times are 7:13.14 min (regular) and 3:51.5 min (modified) and 2:27.52 min (FastMonodomainSolver) and 4s (FastMonodomainSolver with higher timestep widths that are still converging).</p>
<p>The second program uses dynamic load balancing and changes the domain on a single fiber that is computed by a process.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/load_balancing

mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./repartitioning<span class="w"> </span>../settings_repartitioning.py
</pre></div>
</div>
<p>The results can be seen in the following images. Top shows the solution, bottom shows the rank partitioning to 4 ranks. In locations of the stimulus, a higher time step width is used, therefore the overall domain to be computed is smaller.</p>
<a class="reference internal image-reference" href="../_images/load_balancing_5.png" id="load-balancing-5"><img alt="../_images/load_balancing_5.png" id="load-balancing-5" src="../_images/load_balancing_5.png" style="width: 40%;" /></a>
<a class="reference internal image-reference" href="../_images/load_balancing_6.png" id="load-balancing-6"><img alt="../_images/load_balancing_6.png" id="load-balancing-6" src="../_images/load_balancing_6.png" style="width: 40%;" /></a>
<a class="reference internal image-reference" href="../_images/load_balancing_7.png" id="load-balancing-7"><img alt="../_images/load_balancing_7.png" id="load-balancing-7" src="../_images/load_balancing_7.png" style="width: 40%;" /></a>
<a class="reference internal image-reference" href="../_images/load_balancing_8.png" id="load-balancing-8"><img alt="../_images/load_balancing_8.png" id="load-balancing-8" src="../_images/load_balancing_8.png" style="width: 40%;" /></a>
<a class="reference internal image-reference" href="../_images/load_balancing_9.png" id="load-balancing-9"><img alt="../_images/load_balancing_9.png" id="load-balancing-9" src="../_images/load_balancing_9.png" style="width: 40%;" /></a>
<a class="reference internal image-reference" href="../_images/load_balancing_10.png" id="load-balancing-10"><img alt="../_images/load_balancing_10.png" id="load-balancing-10" src="../_images/load_balancing_10.png" style="width: 40%;" /></a>
<a class="reference internal image-reference" href="../_images/load_balancing_11.png" id="load-balancing-11"><img alt="../_images/load_balancing_11.png" id="load-balancing-11" src="../_images/load_balancing_11.png" style="width: 40%;" /></a>
</section>
<section id="fibers-contraction-no-precice">
<h4>fibers_contraction/no_precice<a class="headerlink" href="#fibers-contraction-no-precice" title="Link to this heading"></a></h4>
<p>The <cite>fibers_contraction</cite> examples combine <cite>fibers_emg</cite> with muscle contraction.</p>
<p>Simulate multiple fibers coupled with dynamic contraction.</p>
<figure class="align-default" id="model-schematic-fibers-contraction2">
<a class="reference internal image-reference" href="../_images/model_schematic_fibers_contraction2.svg"><img alt="../_images/model_schematic_fibers_contraction2.svg" src="../_images/model_schematic_fibers_contraction2.svg" width="100%" /></a>
</figure>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/fibers_contraction/no_precice
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release

mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./biceps_contraction<span class="w"> </span>../settings_biceps_contraction.py<span class="w"> </span>ramp.py<span class="w"> </span>--n_subdomains<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="w">   </span><span class="c1"># (1)</span>
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">48</span><span class="w"> </span>./biceps_contraction<span class="w"> </span>../settings_biceps_contraction.py<span class="w"> </span>15mus.py<span class="w">                      </span><span class="c1"># (2)</span>
</pre></div>
</div>
<p>Scenario (1) uses the hodgkin-huxley_razumova subcellular model, which is just Hodgkin-Huxley for action potentials and Razumove for the active stress computation. This allows a fast computation.</p>
<p>Scenario (2) uses the Shorten model.</p>
<figure class="align-default" id="id69">
<span id="fibers-contraction-1"></span><a class="reference internal image-reference" href="../_images/fibers_contraction_1.png"><img alt="../_images/fibers_contraction_1.png" src="../_images/fibers_contraction_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 63 </span><span class="caption-text">Visualization of scenario (1), top left: Vm, top right: homogenized gamma, bottom left: active stress, bottom right: partitioning.</span><a class="headerlink" href="#id69" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>This is a video of the simulation of scenario (1), with end time of 4 seconds.</p>
<iframe width="600" height="380" src="https://www.youtube.com/embed/-7C56qLGGBw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></section>
<section id="fibers-contraction-with-tendons-precice">
<h4>fibers_contraction/with_tendons_precice<a class="headerlink" href="#fibers-contraction-with-tendons-precice" title="Link to this heading"></a></h4>
<figure class="align-default" id="model-schematic-fibers-contraction-with-tendons-precice">
<a class="reference internal image-reference" href="../_images/model_schematic_fibers_contraction_with_tendons_precice.svg"><img alt="../_images/model_schematic_fibers_contraction_with_tendons_precice.svg" src="../_images/model_schematic_fibers_contraction_with_tendons_precice.svg" width="100%" /></a>
</figure>
<p>This example uses precice to couple the muscle and tendon solvers.
The muscle material is incompressible hyperelastic. The tendon material is compressible hyperelastic. Either an isotropic linear Saint-Venant Kirchhoff material or the anisotropic tendon material is used.
There are different scenarios with different material models and different coupling schemes.</p>
<p>Precice needs to be enabled in the <cite>user-variables.scons.py</cite> file. The example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/fibers_contraction/with_tendons_precice
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<ul>
<li><p><strong>only_tendon_static</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/fibers_contraction/with_tendons_precice/only_tendon_static
.<span class="w"> </span>run_force.sh<span class="w">      </span><span class="c1"># run study</span>
./tendon_precice_quasistatic<span class="w"> </span>settings_only_tendon.py<span class="w"> </span>--fiber_file<span class="o">=</span>../meshes/tendon_box.bin<span class="w"> </span>--force<span class="o">=</span><span class="m">1000</span><span class="w">   </span><span class="c1"># run a single simulation</span>
</pre></div>
</div>
</li>
<li><p><strong>Only Tendon</strong></p>
<p>This settings file is to test and debug the tendon material. A box that is fixed on the right and pulled to the left is simulated. The data from <a class="reference external" href="https://www.sciencedirect.com/science/article/abs/pii/S0021929017300726?via%3Dihub">this paper</a> can be reproduced, but adjusting the material parameters for all variants.
The geometry can be created by the script create_cuboid_meshes.sh (you have to read this file and make adjustments to the mesh sizes etc.). The precice adapter is disabled.
Run as follows, adjust the geometry file as needed.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/fibers_contraction/with_tendons_precice/only_tendon_static
.<span class="w"> </span>run_force.sh<span class="w">      </span><span class="c1"># run study</span>
./tendon_precice_quasistatic<span class="w"> </span>settings_only_tendon.py<span class="w"> </span>--fiber_file<span class="o">=</span>../meshes/tendon_box.bin<span class="w"> </span>--force<span class="o">=</span><span class="m">1000</span><span class="w">   </span><span class="c1"># run a single simulation</span>
</pre></div>
</div>
<figure class="align-default" id="id70">
<span id="fibers-contraction-only-tendon"></span><a class="reference internal image-reference" href="../_images/fibers_contraction_only_tendon.png"><img alt="../_images/fibers_contraction_only_tendon.png" src="../_images/fibers_contraction_only_tendon.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 64 </span><span class="caption-text">A result of the tensile test of a cuboid tendon.</span><a class="headerlink" href="#id70" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id71">
<span id="fibers-contraction-only-tendon-1"></span><a class="reference internal image-reference" href="../_images/fibers_contraction_only_tendon_1.png"><img alt="../_images/fibers_contraction_only_tendon_1.png" src="../_images/fibers_contraction_only_tendon_1.png" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 65 </span><span class="caption-text">Reproduction of Fig.4 in of <a class="reference external" href="https://www.sciencedirect.com/science/article/abs/pii/S0021929017300726?via%3Dihub">Carniel et al. (2017) “A transversely isotropic coupled hyperelastic model for the mechanical behavior of tendons”</a>. Different parametrizations of the tendon material are shown. The plot matches the results very well.</span><a class="headerlink" href="#id71" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>There are other examples where only the tendon (with real geometry or as a box) is computed. Try all directories that start with <cite>only_tendon_</cite>.</p>
</li>
<li><p><strong>Explicit Neumann-Dirichlet</strong></p>
<p>Scenario with explicit Neumann-Dirichlet coupling. Only one tendon (the bottom tendon) plus the muscle volume is considered here.
The muscle solver sends displacements and velocities at the coupling surface to the tendon solver, where these values are set as Dirichlet boundary conditions.</p>
<p>The tendon solver sends traction vectors at the coupling surface to the muscle solver where they act as Neumann boundary conditions.</p>
<p>Run the muscle and tendon solvers in two separate terminals. They will communicate over precice.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/fibers_contraction/with_tendons_precice/neumann_dirichlet
./muscle_precice<span class="w"> </span>settings_muscle_neumann_dirichlet.py<span class="w"> </span>ramp.py<span class="w">  </span><span class="c1"># (terminal 1)</span>
./tendon_precice_dynamic<span class="w"> </span>settings_tendon_neumann_dirichlet.py<span class="w">  </span><span class="c1"># (terminal 2)</span>
</pre></div>
</div>
<p>The precice settings file is <cite>precice_config_muscle_neumann_tendon_dirichlet.xml</cite>.</p>
<p>This does not converge, after some timesteps it will fail. This is because of the explicit timestepping and the choice that the muscle has the Neumann boundary conditions and the tendon has the Dirichlet boundary conditions.</p>
</li>
<li><p><strong>Explicit Dirichlet-Neumann</strong></p>
<p>Scenario with explicit Neumann-Dirichlet coupling, the other way round.
The muscle solver sends traction vectors at the coupling surface to the tendon solver where they act as Neumann boundary conditions.
The tendon solver sends displacements and velocities at the coupling surface to the muscle solver, where these values are set as Dirichlet boundary conditions.</p>
<p>Run the muscle and tendon solvers in two separate terminals. They will communicate over precice.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/fibers_contraction/with_tendons_precice/dirichlet_neumann
./muscle_precice<span class="w"> </span>settings_muscle_dirichlet_neumann.py<span class="w"> </span>ramp.py<span class="w">  </span><span class="c1"># (terminal 1)</span>
./tendon_precice_dynamic<span class="w"> </span>settings_tendon_dirichlet_neumann.py<span class="w">  </span><span class="c1"># (terminal 2)</span>
</pre></div>
</div>
<p>The precice settings file is <cite>precice_config_muscle_dirichlet_tendon_neumann.xml</cite>.
This scenario converges and works better than <cite>Explicit Neumann-Dirichlet</cite>.</p>
<p>Note that there is a variant of this scenario in <cite>dirichlet_neumann_linear</cite> which uses a linear hyperelastic material for the tendon.</p>
</li>
<li><p><strong>Implicit Dirichlet-Neumann</strong></p>
<p>This is the same as explicit Dirichlet-Neumann scenario but this time with implicit coupling in precice.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/fibers_contraction/with_tendons_precice/implicit_coupling_dirichlet_neumann
./muscle_precice<span class="w"> </span>settings_muscle_implicit_dirichlet_neumann.py<span class="w"> </span>ramp.py<span class="w">  </span><span class="c1"># (terminal 1)</span>
./tendon_precice_dynamic<span class="w"> </span>settings_tendon_implicit_dirichlet_neumann.py<span class="w">  </span><span class="c1"># (terminal 2)</span>
</pre></div>
</div>
<p>The precice settings file is <cite>precice_config_muscle_dirichlet_tendon_neumann.xml</cite>. This scenario also works.</p>
</li>
<li><p><strong>Linear Implicit Dirichlet-Neumann</strong></p>
<p>This is the same as <cite>Implicit Dirichlet-Neumann</cite> scenario except that it uses a linear Saint-Venant Kirchhoff material for the tendon instead of the nonlinear Tendon material. Note that the tendon is still geometrically nonlinear and therefore needs to be solved by a Newton scheme.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/fibers_contraction/with_tendons_precice/implicit_coupling_dirichlet_neumann_linear
./muscle_precice<span class="w"> </span>settings_muscle_implicit_dirichlet_neumann.py<span class="w"> </span>ramp.py<span class="w">         </span><span class="c1"># (terminal 1)</span>
./tendon_linear_precice_dynamic<span class="w"> </span>settings_tendon_implicit_dirichlet_neumann.py<span class="w">  </span><span class="c1"># (terminal 2)</span>
</pre></div>
</div>
<p>This scenario is a bit faster than <cite>Implicit Dirichlet-Neumann</cite>  because of the tendon solver. It also has better convergence properties.</p>
</li>
<li><p><strong>Multiple Tendons</strong></p>
<p>This example simulates the biceps muscle with both tendons. It uses the Saint-Venant-Kirchhoff material for the tendons. The top tendons are represented by two separate meshes. In total, there are 4 coupling participants that are implicitely coupled with precice: three tendons, one muscle.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/fibers/fibers_contraction/with_tendons_precice/multiple_tendons
./muscle_precice<span class="w"> </span>settings_muscle.py<span class="w"> </span>ramp.py<span class="w">               </span><span class="c1"># (terminal 1)</span>
./tendon_linear_precice_dynamic<span class="w"> </span>settings_tendon_bottom.py<span class="w"> </span><span class="c1"># (terminal 2)</span>
./tendon_linear_precice_dynamic<span class="w"> </span>settings_tendon_top_a.py<span class="w">  </span><span class="c1"># (terminal 3)</span>
./tendon_linear_precice_dynamic<span class="w"> </span>settings_tendon_top_b.py<span class="w">  </span><span class="c1"># (terminal 4)</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="multidomain">
<h3>Multidomain<a class="headerlink" href="#multidomain" title="Link to this heading"></a></h3>
<p>The multidomain equations are the 3D homogenized formulation of electrophysiology that replace the Monodomain Equation and the need for fibers. The 3D meshes are created from the same files that also contain the fiber information.
This means we still have fibers in the geometry description. Also the relative factors <span class="math notranslate nohighlight">\(f_r\)</span> are created as Gaussians with their center around particular fibers.</p>
<section id="static-bidomain">
<h4>static_bidomain<a class="headerlink" href="#static-bidomain" title="Link to this heading"></a></h4>
<p>This example uses the <a class="reference internal" href="../settings/static_bidomain_solver.html"><span class="doc">StaticBidomainSolver</span></a> and connects it to <a class="reference internal" href="../settings/prescribed_values.html"><span class="doc">PrescribedValues</span></a>. This allows to work with the Bidomain problem without any fibers or electrophysiology attached. Static Bidomain is listed under Multidomain because it is a specialization of the Multidomain Equations.</p>
<p>Examples that use the <a class="reference internal" href="../settings/static_bidomain_solver.html"><span class="doc">StaticBidomainSolver</span></a> and electrophysiology using muscle fibers are <cite>fibers_emg</cite> and <cite>fibers_fat_emg</cite>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/multidomain/static_bidomain/build_release
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release

mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>./static_bidomain_solver<span class="w"> </span>../settings_static_bidomain.py<span class="w"> </span>normal.py<span class="w">   </span><span class="c1"># (1)</span>
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>./prescribed_static_bidomain_solver<span class="w"> </span>../settings_static_bidomain.py<span class="w"> </span>normal.py<span class="w">   </span><span class="c1"># (2)</span>

Scenario<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span>simply<span class="w"> </span>calls<span class="w"> </span>the<span class="w"> </span>:doc:<span class="sb">`</span>static_bidomain_solver<span class="sb">`</span><span class="w"> </span>on<span class="w"> </span>a<span class="w"> </span>static<span class="w"> </span>problem.<span class="w"> </span>Because<span class="w"> </span>no<span class="w"> </span>:math:<span class="sb">`</span>V_m<span class="sb">`</span><span class="w"> </span>values<span class="w"> </span>are<span class="w"> </span>prescribed,<span class="w"> </span>the<span class="w"> </span>result<span class="w"> </span>is<span class="w"> </span><span class="m">0</span>.<span class="w"> </span>This<span class="w"> </span>example<span class="w"> </span>is<span class="w"> </span>only<span class="w"> </span>used<span class="w"> </span><span class="k">for</span><span class="w"> </span>debugging<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>StaticBidomainSolver.

Scenario<span class="w"> </span><span class="o">(</span><span class="m">2</span><span class="o">)</span><span class="w"> </span>couples<span class="w"> </span>the<span class="w"> </span>:doc:<span class="sb">`</span>static_bidomain_solver<span class="sb">`</span><span class="w"> </span>with<span class="w"> </span>a<span class="w"> </span>:doc:<span class="sb">`</span>prescribed_values<span class="sb">`</span><span class="w"> </span>element<span class="w"> </span>where<span class="w"> </span>values<span class="w"> </span>of<span class="w"> </span>:math:<span class="sb">`</span>V_m<span class="sb">`</span><span class="w"> </span>are<span class="w"> </span>prescribed<span class="w"> </span>over<span class="w"> </span><span class="nb">time</span><span class="w"> </span>by<span class="w"> </span>a<span class="w"> </span>sine<span class="w"> </span><span class="k">function</span>.
The<span class="w"> </span>extracellular<span class="w"> </span>potentials<span class="w"> </span>are<span class="w"> </span>computed<span class="w"> </span>by<span class="w"> </span>solving<span class="w"> </span>the<span class="w"> </span>static<span class="w"> </span>bidomain<span class="w"> </span>equation.

Instead<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>scenario<span class="w"> </span>file<span class="w"> </span><span class="sb">`</span>normal.py<span class="sb">`</span>,<span class="w"> </span>also<span class="w"> </span><span class="sb">`</span>small.py<span class="sb">`</span><span class="w"> </span>is<span class="w"> </span>available.<span class="w"> </span>The<span class="w"> </span>scenario<span class="w"> </span>files<span class="w"> </span>are<span class="w"> </span>stored<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span><span class="sb">`</span>variables<span class="sb">`</span><span class="w"> </span>subdirectory.
Any<span class="w"> </span>number<span class="w"> </span>of<span class="w"> </span>processes<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>used.
</pre></div>
</div>
<figure class="align-default" id="id72">
<span id="model-schematic-static-bidomain"></span><a class="reference internal image-reference" href="../_images/model_schematic_static_bidomain.svg"><img alt="../_images/model_schematic_static_bidomain.svg" src="../_images/model_schematic_static_bidomain.svg" width="100%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 66 </span><span class="caption-text">Models that are used in the <cite>static_bidomain</cite> example.</span><a class="headerlink" href="#id72" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id73">
<span id="static-bidomain-1"></span><a class="reference internal image-reference" href="../_images/static_bidomain_1.png"><img alt="../_images/static_bidomain_1.png" src="../_images/static_bidomain_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 67 </span><span class="caption-text">Top image: prescribed trans-membrane potential, <span class="math notranslate nohighlight">\(V_m\)</span>. The two meshes can be seen: the muscle belly (red) and the fat layer (blue) on top.
Bottom image: value of the extracellular potential, <span class="math notranslate nohighlight">\(\phi_e\)</span>. A “wave” moves along the muscle because of the prescribed values of <span class="math notranslate nohighlight">\(V_m\)</span> given by the sine function.</span><a class="headerlink" href="#id73" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="multidomain-no-fat">
<h4>multidomain_no_fat<a class="headerlink" href="#multidomain-no-fat" title="Link to this heading"></a></h4>
<p>This is the basic Multidomain example that only considers the 3D muscle domain without fat layer.</p>
<p>It has been used for investigating parallel-in-time algorithms, such as Multigrid-reduction-in-time.</p>
<figure class="align-default" id="id74">
<span id="model-schematic-multidomain-no-fat"></span><a class="reference internal image-reference" href="../_images/model_schematic_multidomain_no_fat.svg"><img alt="../_images/model_schematic_multidomain_no_fat.svg" src="../_images/model_schematic_multidomain_no_fat.svg" width="100%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 68 </span><span class="caption-text">Models that are used in the <cite>multidomain_no_fat</cite> example.</span><a class="headerlink" href="#id74" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/multidomain/multidomain_no_fat
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release
</pre></div>
</div>
<figure class="align-default" id="id75">
<span id="multidomain-no-fat-1"></span><a class="reference internal image-reference" href="../_images/multidomain_no_fat_1.png"><img alt="../_images/multidomain_no_fat_1.png" src="../_images/multidomain_no_fat_1.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 69 </span><span class="caption-text">The relative factors, <span class="math notranslate nohighlight">\(f_r^k\)</span> for two compartments, <span class="math notranslate nohighlight">\(k=1,2\)</span>.</span><a class="headerlink" href="#id75" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Care must be taken to use exact solvers and low tolerances, as well as a high spatial resolution. Otherwise the stimuli will reflect at the boundaries of the muscle which is not physical.</p>
</section>
<section id="multidomain-with-fat">
<h4>multidomain_with_fat<a class="headerlink" href="#multidomain-with-fat" title="Link to this heading"></a></h4>
<p>This is the full Multidomain model also including a fat domain.</p>
<figure class="align-default" id="id76">
<span id="model-schematic-multidomain-with-fat"></span><a class="reference internal image-reference" href="../_images/model_schematic_multidomain_with_fat.svg"><img alt="../_images/model_schematic_multidomain_with_fat.svg" src="../_images/model_schematic_multidomain_with_fat.svg" width="100%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 70 </span><span class="caption-text">Models that are used in the <cite>multidomain_with_fat</cite> example.</span><a class="headerlink" href="#id76" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/multidomain/multidomain_with_fat
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release

mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">12</span><span class="w"> </span>./multidomain_with_fat<span class="w"> </span>../settings_multidomain_with_fat.py<span class="w"> </span>neon.py<span class="w">       </span><span class="c1"># short runtime</span>
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">12</span><span class="w"> </span>./multidomain_with_fat<span class="w"> </span>../settings_multidomain_with_fat.py<span class="w"> </span>ramp_emg.py<span class="w">   </span><span class="c1"># longer</span>
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">128</span><span class="w"> </span>./multidomain_with_fat<span class="w"> </span>../settings_multidomain_with_fat.py<span class="w"> </span>ramp_emg.py<span class="w"> </span>--n_subdomains<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">32</span>
</pre></div>
</div>
<p>Instead of 12 processes, any other number can be used.</p>
<figure class="align-default" id="multidomain-with-fat-1">
<a class="reference internal image-reference" href="../_images/multidomain_with_fat_1.png"><img alt="../_images/multidomain_with_fat_1.png" src="../_images/multidomain_with_fat_1.png" style="width: 20%;" /></a>
</figure>
<p>EMG on the surface, at t = 1.406 s. Also the fine resolution can be seen</p>
<figure class="align-default" id="id77">
<span id="multidomain-with-fat-2"></span><a class="reference internal image-reference" href="../_images/multidomain_with_fat_2.png"><img alt="../_images/multidomain_with_fat_2.png" src="../_images/multidomain_with_fat_2.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 71 </span><span class="caption-text">View of <span class="math notranslate nohighlight">\(V_m\)</span> in all 10 compartments (small images at the right), the resulting potential in the body domain, <span class="math notranslate nohighlight">\(\phi_b\)</span> (top center), and the surface EMG (left, big)</span><a class="headerlink" href="#id77" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id78">
<span id="multidomain-with-fat-3"></span><a class="reference internal image-reference" href="../_images/multidomain_with_fat_3.png"><img alt="../_images/multidomain_with_fat_3.png" src="../_images/multidomain_with_fat_3.png" style="width: 20%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 72 </span><span class="caption-text">Partitioning with 12 processes.</span><a class="headerlink" href="#id78" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id79">
<span id="multidomain-with-fat-4"></span><a class="reference internal image-reference" href="../_images/multidomain_with_fat_4.png"><img alt="../_images/multidomain_with_fat_4.png" src="../_images/multidomain_with_fat_4.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 73 </span><span class="caption-text">This is the scenario with 128 processes, top: partitioning, each color corresponds to one rank. Bottom: EMG signal, it can be seen that this is very smooth, because of the high spatial resolution.</span><a class="headerlink" href="#id79" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="multidomain-with-fat-6">
<a class="reference internal image-reference" href="../_images/multidomain_with_fat_6.png"><img alt="../_images/multidomain_with_fat_6.png" src="../_images/multidomain_with_fat_6.png" style="width: 60%;" /></a>
</figure>
</section>
<section id="multidomain-contraction">
<h4>multidomain_contraction<a class="headerlink" href="#multidomain-contraction" title="Link to this heading"></a></h4>
<p>This is the Multidomain model with fat combined with muscle contraction.</p>
<figure class="align-default" id="id80">
<span id="model-schematic-multidomain-contraction"></span><a class="reference internal image-reference" href="../_images/model_schematic_multidomain_contraction.svg"><img alt="../_images/model_schematic_multidomain_contraction.svg" src="../_images/model_schematic_multidomain_contraction.svg" width="100%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 74 </span><span class="caption-text">Models that are used in the <cite>multidomain_contraction</cite> example.</span><a class="headerlink" href="#id80" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id81">
<span id="multidomain-contraction-jacobian"></span><a class="reference internal image-reference" href="../_images/multidomain_contraction_jacobian2.png"><img alt="../_images/multidomain_contraction_jacobian2.png" src="../_images/multidomain_contraction_jacobian2.png" style="width: 40%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 75 </span><span class="caption-text">The non-zero structure of the material Jacobian of the nonlinear problem, use options <a class="reference external" href="https://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/Mat/MatView.html">-mat_view draw -draw_pause</a> 3 to display this structure.
Example with 3 x 3 x 10 = 90 global quadratic elements in the muscle domain and 6 x 1 x 10 = 60 elements in the fat domain, in total 150.</span><a class="headerlink" href="#id81" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="multidomain-motoneuron">
<h4>multidomain_motoneuron<a class="headerlink" href="#multidomain-motoneuron" title="Link to this heading"></a></h4>
<p>This is the Multidomain model with fat and contraction and using a motoneuron to get the stimulation.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/multidomain/multidomain_motoneuron
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release

mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">12</span><span class="w"> </span>./multidomain_motoneuron<span class="w"> </span>../settings_multidomain_motoneuron.py<span class="w"> </span>coarse.py
</pre></div>
</div>
<figure class="align-default" id="id82">
<span id="model-schematic-multidomain-motoneuron"></span><a class="reference internal image-reference" href="../_images/model_schematic_multidomain_motoneuron.svg"><img alt="../_images/model_schematic_multidomain_motoneuron.svg" src="../_images/model_schematic_multidomain_motoneuron.svg" width="100%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 76 </span><span class="caption-text">Models that are used in the <cite>multidomain_motoneuron</cite> example.</span><a class="headerlink" href="#id82" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="neuromuscular">
<h3>Neuromuscular<a class="headerlink" href="#neuromuscular" title="Link to this heading"></a></h3>
<p>Several examples to simulate motoneurons and sensor organs exist, but this is still work in progress.</p>
<section id="only-neurons-hodgkin-huxley">
<h4>only_neurons_hodgkin_huxley<a class="headerlink" href="#only-neurons-hodgkin-huxley" title="Link to this heading"></a></h4>
<figure class="align-default" id="id83">
<span id="model-schematic-only-neurons"></span><a class="reference internal image-reference" href="../_images/model_schematic_only_neurons.svg"><img alt="../_images/model_schematic_only_neurons.svg" src="../_images/model_schematic_only_neurons.svg" width="100%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 77 </span><span class="caption-text">Models that are used in the <cite>only_neurons_hodgkin_huxley</cite> example.</span><a class="headerlink" href="#id83" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>This example implements muscle spindles, Golgi tendon organs, interneurons and motor neurons. All sensors and the interneurons use the Hodgkin-Huxley CellML model. The motoneuron uses the <cite>MN_Cisi_Kohn_2008</cite> model.
The architecture is shown in <a class="reference internal" href="#only-neurons-hodgkin-huxley-1"><span class="std std-numref">Fig. 78</span></a>.</p>
<figure class="align-default" id="id84">
<span id="only-neurons-hodgkin-huxley-1"></span><a class="reference internal image-reference" href="../_images/only_neurons_hodgkin_huxley_1.svg"><img alt="../_images/only_neurons_hodgkin_huxley_1.svg" src="../_images/only_neurons_hodgkin_huxley_1.svg" width="100%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 78 </span><span class="caption-text">Schematic of the architecture of sensor organs and neurons that is implemented.</span><a class="headerlink" href="#id84" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Compile and run the example like the following, then call the python plotting script.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/neuromuscular/only_neurons_hodgkin_huxley
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release

./only_neurons<span class="w"> </span>../settings_only_neurons_hodgkin_huxley.py<span class="w"> </span>normal.py
./plot_all.py
</pre></div>
</div>
<p>The plot script produces the following plot:</p>
<figure class="align-default" id="id85">
<span id="only-neurons-hodgkin-huxley-2"></span><a class="reference internal image-reference" href="../_images/only_neurons_hodgkin_huxley_2.png"><img alt="../_images/only_neurons_hodgkin_huxley_2.png" src="../_images/only_neurons_hodgkin_huxley_2.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 79 </span><span class="caption-text">Plot window of the scenario. In the top plot, the muscle spindle input (dotted lines) and output (solid lines) are shown. The input is prescribed by a <span class="math notranslate nohighlight">\(\sin^2(t)\)</span> function.
The second and third plots show the Golgi tendon organs and the interneurons, again with inputs (dotted lines) and outputs (solid lines). There are three instances of each of them.
The input to the motor neurons is shown in the bottom plot by the dotted lines. It is the sum of the scaled outputs of Interneurons and Muscle spindles, with a time delay from the interneurons.
The output of the motor neurons are the solid lines at the bottom.</span><a class="headerlink" href="#id85" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="only-neurons-mileusenic">
<h4>only_neurons_mileusenic<a class="headerlink" href="#only-neurons-mileusenic" title="Link to this heading"></a></h4>
<p>Same as <cite>only_neurons_hodgkin_huxley</cite>, but uses the Mileusenic muscle spindle model.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/neuromuscular/only_neurons_hodgkin_huxley
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release

./only_neurons_mileusenic<span class="w"> </span>../settings_only_neurons_mileusenic.py<span class="w"> </span>monosynaptic.py
./plot_mileusenic.py
</pre></div>
</div>
</section>
<section id="only-neurons-hierarchical-structure">
<h4>only_neurons_hierarchical_structure<a class="headerlink" href="#only-neurons-hierarchical-structure" title="Link to this heading"></a></h4>
<p>Logically the same as <cite>only_neurons_hodgkin_huxley</cite>. The structure of the c++ main file is different. It does not use the <a class="reference external" href="/settings/multiple_coupling">Control::MultipleCoupling</a> scheme, instead is uses 4 nested <code class="docutils literal notranslate"><span class="pre">Control::Coupling</span></code> schemes which is very confusing.
This example is kept here, because it works and for learning purposes, to demonstrate how to not use <code class="docutils literal notranslate"><span class="pre">Control::MultipleCoupling</span></code>.
You can compare the <cite>solver_structure.txt</cite> files of the examples <cite>only_neurons_hodgkin_huxley</cite> and <cite>only_neurons_hierarchical_structure</cite>.</p>
<p>./only_neurons ../settings_only_neurons.py spindles.py</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/neuromuscular/only_neurons_hierarchical_structure
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release

./only_neurons<span class="w"> </span>../settings_only_neurons_hodgkin_huxley.py<span class="w"> </span>spindles.py
</pre></div>
</div>
</section>
<section id="neurons-with-contraction">
<h4>neurons_with_contraction<a class="headerlink" href="#neurons-with-contraction" title="Link to this heading"></a></h4>
<p>This example combines the sensors and neurons with the elasticity solver. The architecture in <a class="reference internal" href="#only-neurons-hodgkin-huxley-1"><span class="std std-numref">Fig. 78</span></a> also holds for this example.</p>
<p>The active stress <span class="math notranslate nohighlight">\(\gamma\)</span> in the 3D domain is prescribed by a <span class="math notranslate nohighlight">\(sin\)</span> function. The 3D mechanics is computed with the muscle material. The muscle spindles and Golgi tendon organs get their values from the deforming 3D domain.
All sensors and the interneurons use the Hodgkin-Huxley CellML model. The motoneuron uses the <cite>MN_Cisi_Kohn_2008</cite> model.</p>
<figure class="align-default" id="model-schematic-neurons-with-contraction">
<a class="reference internal image-reference" href="../_images/model_schematic_neurons_with_contraction.svg"><img alt="../_images/model_schematic_neurons_with_contraction.svg" src="../_images/model_schematic_neurons_with_contraction.svg" width="100%" /></a>
</figure>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPENDIHU_HOME</span>/examples/electrophysiology/neuromuscular/neurons_with_contraction
mkorn<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sr<span class="w">       </span><span class="c1"># build</span>
<span class="nb">cd</span><span class="w"> </span>build_release

./neurons_with_contraction<span class="w"> </span>../settings_neurons_with_contraction.py<span class="w"> </span>spindles.py
./plot_all.py
</pre></div>
</div>
<figure class="align-default" id="id86">
<span id="only-neurons-hodgkin-huxley-3"></span><a class="reference internal image-reference" href="../_images/only_neurons_hodgkin_huxley_3.png"><img alt="../_images/only_neurons_hodgkin_huxley_3.png" src="../_images/only_neurons_hodgkin_huxley_3.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 80 </span><span class="caption-text">Result of the sensors and neurons for this example.</span><a class="headerlink" href="#id86" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="examples.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="validation.html" class="btn btn-neutral float-right" title="Validation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Benjamin Maier. MIT licence, see LICENSE for details..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>